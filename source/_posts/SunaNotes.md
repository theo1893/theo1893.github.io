---
title: Suna源码学习笔记
categories:
  - Tech
tags:
  - Agent
date: 2025-07-30 19:37:07
---


# Suna源码学习笔记

[Suna](https://github.com/kortix-ai/suna)是一个开源的全栈ReAct Agent项目, 和OpenManus使用相同的底层逻辑. 然而和OpenManus不同在于, Suna是一个完整的业务系统, 包含完整的提示词工程、完备的工具集、用户管理和计费管理, 以及生产级别的数据持久化. 

下面对Suna源码和其执行流程进行简单分析.

<font color="red">以下对代码逻辑的记录截止于2025-07-23 00:00:00 UTC+8</font>




## 任务流程图
Suna发起一次任务的工作流大致如下图所示

![](task_process.excalidraw.svg)

Suna不单独区分Flow/Non-Flow模式, 而是将一切决策权交给LLM:

LLM判断不需要做planning, 就等同于一次普通的LLM调用;

LLM判断需要做planning, 则调用工具创建todo.md, 并且**后续的step维护均交给LLM处理**, 此处没有人工介入;



## 沙盒

Suna使用daytona沙盒供应商, 工具集中对沙盒的操作分为2类: 

- 通过daytona提供的api调用. 这一类主要是shell命令和文件操作. 
  - shell命令的执行均使用tmux, 命令的执行结果通过tmux capture-pane 获取.
  - 文件操作直接使用daytona提供的fs api.
- 通过镜像中暴露的api服务调用. 这一类是浏览器操作, 封装由Suna开发, 固定路径为localhost:8003/api/automation/{endpoint}

沙盒调用的基本流程如下图所示

![](sanbox.excalidraw.svg)



## 工具集

Suna将不同的工具按照类别归属到特定的工具集中, 其中大量工具和沙盒相关.

等效工具数为83(50个为data provider接口, 33个其他工具).

### SandboxShellTool

此工具集处理shell相关的toll call, 包含4个tool. 所有命令均使用tmux执行.

#### execute-command

把command发送到daytona沙箱执行, 并获取终端输出.

#### check_command_output

获取当前daytona沙箱终端的输出.

#### terminate_command

终止指定的session

#### list_commands

获取当前沙箱内所有的tmux sessions.



### SandboxFilesTool

此工具集处理文件io相关的tool call, 包含4个tool. 操作通过daytona封装的toolbox_api执行, 所有的path均位于/workspace下.

#### create_file

创建文件, 把生成的内容写入path.

#### str_replace

替换path文件里的指定内容, old_str -> new_str.

#### full_file_rewrite

用指定内容, 覆盖path文件.

### SandboxBrowserTool

此工具集处理浏览器相关的tool call, 包含15个tool. 所有操作流程均为构造curl请求, 在沙盒本地调用暴露的api, 路径为: http://localhost:8003/api/automation/{endpoint}

eg. negivate_to调用会产生如下指令

```Shell
## 此命令会被发送到sandbox执行
curl -s -X POST 'http://localhost:8003/api/automation/negivate_to' -H 'Content-Type: application/json -d '{"url": "target url"}'
```

在进行操作结束后, 镜像会将浏览器当前页面状态记录下来, 然后返回给Suna, Suna会把这些状态记录以特殊的type(**browser_state**)写入db

```Shell
## ... 浏览器操作完成
## 浏览器操作的响应会在tool message之前先写入db
added_message = await self.thread_manager.add_message(
    thread_id=self.thread_id,
    type="browser_state",  ## 特殊的type 
    content=result,        ## 返回的payload
    is_llm_message=False
)
```

浏览器页面状态由以下字段构成: 

- 当前页面的DOM state
- 当前页面的截屏(base64)
- 当前页面的等效HTML字符串
- 一些metadata

下面的所有接口, 均直接记录沙盒内api的逻辑.

#### browser_navigate_to

浏览器当前页面进入指定url, 并返回浏览器状态.

#### browser_go_back

浏览器当前页面go back, 并返回浏览器状态.

#### browser_wait

浏览器当前页面等待几秒, 并返回浏览器状态.

#### browser_click_element

点击指定index的dom对象, 并返回浏览器状态.

#### browser_input_text

在指定index的dom对象中输入text, 并返回浏览器状态.

#### browser_send_keys

在当前页面输入keys, 并返回浏览器状态.

#### browser_switch_tab

切换到指定tab, 并返回浏览器状态.

#### browser_close_tab

关闭tab, 并返回浏览器状态.

#### browser_scroll_down

页面下滑N个像素单位, 并返回浏览器状态.

#### browser_scroll_up

页面上滑N个像素单位, 并返回浏览器状态.

#### browser_scroll_to_text

页面滑动到指定text可见, 并返回浏览器状态.

#### browser_get_dropdown_options

获取指定index的dom元素的下拉列表, 并返回浏览器状态.

#### browser_select_dropdown_option

选中下拉列表的项目, 并返回浏览器状态.

#### browser_drag_drop

根据入参坐标, 在当前页面执行鼠标操作实现拖拽, 并返回浏览器状态.

#### browser_click_coordinates

/api/automation/click_coordinates

鼠标点击坐标, 并返回浏览器状态.



### SandboxDeployTool

此工具集仅包含1个工具

#### deploy

将沙盒中指定路径的project作为静态网站部署到Cloudflare.



### SandboxExposeTool

此工具集仅包含1个工具

#### expose

将沙盒的指定port暴露到公网, 并使用daytona给这个port生成一个可访问的url.



### ExpandMessageTool

此工具集仅包含1个工具

#### expand_message

查询指定id的message, 将其完整内容返回. 推测是用于在上下文压缩的场景下, 给llm获取完整内容的途径.



### SandboxWebSearchTool

此工具集包含2个工具, 用于网页数据查询.

#### web_search

使用tavily对指定的query进行查询.

#### scrape_webpage

使用firecrawl爬指定url的数据.



### SandboxVisionTool

此工具集包含1个工具

#### see_image

从指定的sandbox path 或者 url 下载图像数据, 压缩到5MB以内, 然后和浏览器操作一样, 以特殊的type(**image_context**)写进db.

```Python
# Prepare the temporary message content
image_context_data = {
    "mime_type": compressed_mime_type,
    "base64": base64_image,
    "file_path": cleaned_path, # Include path for context
    "original_size": original_size,
    "compressed_size": len(compressed_bytes)
}

# Add the temporary message using the thread_manager callback
# Use a distinct type like 'image_context'
await self.thread_manager.add_message(
    thread_id=self.thread_id,
    type="image_context", # Use a specific type for this
    content=image_context_data, # Store the dict directly
    is_llm_message=False # This is context generated by a tool
```



### SandboxImageEditTool

此工具集包含1个工具

#### image_edit_or_generate

调用gpt-image-1模型, 根据入参prompt生成新的图像, 或者对指定path的图像进行修改.



### DataProvidersTool

此工具集包含2个工具, 用于调用rapidapi的数据接口.

Suna默认注册了5个provider, 对应到rapidapi中是5个独立的服务供应商. 如果要使用这个工具, 配置文件中的RAPID_API_KEY需要订阅对应的供应商.

```Shell
self.register_data_providers = {
    "linkedin": LinkedinProvider(),
    "yahoo_finance": YahooFinanceProvider(),
    "amazon": AmazonProvider(),
    "zillow": ZillowProvider(),
    "twitter": TwitterProvider()
}
```

#### get_data_provider_endpoints

根据指定的service, 获取对应供应商提供的api list. 

eg. LLM需要获取Twitter的数据, 在此轮工具调用中需要获取Twitter data provider提供的api list. 指定的provider提供的可用api list如下:

```JSON
{
    "user_info": {
        "route": "/screenname.php",
        "method": "GET",
        "name": "Twitter User Info",
        "description": "Get information about a Twitter user by screenname or user ID.",
        "payload": {
            "screenname": "Twitter username without the @ symbol",
            "rest_id": "Optional Twitter user's ID. If provided, overwrites screenname parameter."
        }
    },
    "timeline": {
        "route": "/timeline.php",
        "method": "GET",
        "name": "User Timeline",
        "description": "Get tweets from a user's timeline.",
        "payload": {
            "screenname": "Twitter username without the @ symbol",
            "rest_id": "Optional parameter that overwrites the screenname",
            "cursor": "Optional pagination cursor"
        }
    },
    "following": {
        "route": "/following.php",
        "method": "GET",
        "name": "User Following",
        "description": "Get users that a specific user follows.",
        "payload": {
            "screenname": "Twitter username without the @ symbol",
            "rest_id": "Optional parameter that overwrites the screenname",
            "cursor": "Optional pagination cursor"
        }
    },
    "followers": {
        "route": "/followers.php",
        "method": "GET",
        "name": "User Followers",
        "description": "Get followers of a specific user.",
        "payload": {
            "screenname": "Twitter username without the @ symbol",
            "cursor": "Optional pagination cursor"
        }
    },
    "search": {
        "route": "/search.php",
        "method": "GET",
        "name": "Twitter Search",
        "description": "Search for tweets with a specific query.",
        "payload": {
            "query": "Search query string",
            "cursor": "Optional pagination cursor",
            "search_type": "Optional search type (e.g. 'Top')"
        }
    },
    "replies": {
        "route": "/replies.php",
        "method": "GET",
        "name": "User Replies",
        "description": "Get replies made by a user.",
        "payload": {
            "screenname": "Twitter username without the @ symbol",
            "cursor": "Optional pagination cursor"
        }
    },
    "check_retweet": {
        "route": "/checkretweet.php",
        "method": "GET",
        "name": "Check Retweet",
        "description": "Check if a user has retweeted a specific tweet.",
        "payload": {
            "screenname": "Twitter username without the @ symbol",
            "tweet_id": "ID of the tweet to check"
        }
    },
    "tweet": {
        "route": "/tweet.php",
        "method": "GET",
        "name": "Get Tweet",
        "description": "Get details of a specific tweet by ID.",
        "payload": {
            "id": "ID of the tweet"
        }
    },
    "tweet_thread": {
        "route": "/tweet_thread.php",
        "method": "GET",
        "name": "Get Tweet Thread",
        "description": "Get a thread of tweets starting from a specific tweet ID.",
        "payload": {
            "id": "ID of the tweet",
            "cursor": "Optional pagination cursor"
        }
    },
    "retweets": {
        "route": "/retweets.php",
        "method": "GET",
        "name": "Get Retweets",
        "description": "Get users who retweeted a specific tweet.",
        "payload": {
            "id": "ID of the tweet",
            "cursor": "Optional pagination cursor"
        }
    },
    "latest_replies": {
        "route": "/latest_replies.php",
        "method": "GET",
        "name": "Get Latest Replies",
        "description": "Get the latest replies to a specific tweet.",
        "payload": {
            "id": "ID of the tweet",
            "cursor": "Optional pagination cursor"
        }
    }
}
```

#### execute_data_provider_call

构造rapidapi的请求体, 向指定的endpoint发起调用.



### MessageTool

此工具集包含3个特殊工具, 执行**任一工具**均会导致外层ReAct循环终止.

需要注意的是, 这里的3个工具没有任何内部逻辑, 仅是返回文本. 用户侧的逻辑处理在前端.

#### ask

向用户发起提问.

#### web_browser_takeover

在复杂的浏览器流程下, llm要求用户接管本次浏览器操作.

#### complete

完成本次agent任务处理.



## ReAct细节

### 系统提示词

默认的系统提示词详细定义了各个流程，以及工具的使用方法、优先级等.

```Markdown
You are Suna.so, an autonomous AI Agent created by the Kortix team.

# 1. CORE IDENTITY & CAPABILITIES
You are a full-spectrum autonomous agent capable of executing complex tasks across domains including information gathering, content creation, software development, data analysis, and problem-solving. You have access to a Linux environment with internet connectivity, file system operations, terminal commands, web browsing, and programming runtimes.

# 2. EXECUTION ENVIRONMENT

## 2.1 WORKSPACE CONFIGURATION
- WORKSPACE DIRECTORY: You are operating in the "/workspace" directory by default
- All file paths must be relative to this directory (e.g., use "src/main.py" not "/workspace/src/main.py")
- Never use absolute paths or paths starting with "/workspace" - always use relative paths
- All file operations (create, read, write, delete) expect paths relative to "/workspace"
## 2.2 SYSTEM INFORMATION
- BASE ENVIRONMENT: Python 3.11 with Debian Linux (slim)
- UTC DATE: {{current_date}}
- UTC TIME: {{current_time}}
- CURRENT YEAR: 2025
- TIME CONTEXT: When searching for latest news or time-sensitive information, ALWAYS use these current date/time values as reference points. Never use outdated information or assume different dates.
- INSTALLED TOOLS:
  * PDF Processing: poppler-utils, wkhtmltopdf
  * Document Processing: antiword, unrtf, catdoc
  * Text Processing: grep, gawk, sed
  * File Analysis: file
  * Data Processing: jq, csvkit, xmlstarlet
  * Utilities: wget, curl, git, zip/unzip, tmux, vim, tree, rsync
  * JavaScript: Node.js 20.x, npm
- BROWSER: Chromium with persistent session support
- PERMISSIONS: sudo privileges enabled by default
## 2.3 OPERATIONAL CAPABILITIES
You have the ability to execute operations using both Python and CLI tools:
### 2.3.1 FILE OPERATIONS
- Creating, reading, modifying, and deleting files
- Organizing files into directories/folders
- Converting between file formats
- Searching through file contents
- Batch processing multiple files

### 2.3.2 DATA PROCESSING
- Scraping and extracting data from websites
- Parsing structured data (JSON, CSV, XML)
- Cleaning and transforming datasets
- Analyzing data using Python libraries
- Generating reports and visualizations

### 2.3.3 SYSTEM OPERATIONS
- Running CLI commands and scripts
- Compressing and extracting archives (zip, tar)
- Installing necessary packages and dependencies
- Monitoring system resources and processes
- Executing scheduled or event-driven tasks
- Exposing ports to the public internet using the 'expose-port' tool:
  * Use this tool to make services running in the sandbox accessible to users
  * Example: Expose something running on port 8000 to share with users
  * The tool generates a public URL that users can access
  * Essential for sharing web applications, APIs, and other network services
  * Always expose ports when you need to show running services to users

### 2.3.4 WEB SEARCH CAPABILITIES
- Searching the web for up-to-date information with direct question answering
- Retrieving relevant images related to search queries
- Getting comprehensive search results with titles, URLs, and snippets
- Finding recent news, articles, and information beyond training data
- Scraping webpage content for detailed information extraction when needed 

### 2.3.5 BROWSER TOOLS AND CAPABILITIES
- BROWSER OPERATIONS:
  * Navigate to URLs and manage history
  * Fill forms and submit data
  * Click elements and interact with pages
  * Extract text and HTML content
  * Wait for elements to load
  * Scroll pages and handle infinite scroll
  * YOU CAN DO ANYTHING ON THE BROWSER - including clicking on elements, filling forms, submitting data, etc.
  * The browser is in a sandboxed environment, so nothing to worry about.

### 2.3.6 VISUAL INPUT
- You MUST use the 'see_image' tool to see image files. There is NO other way to access visual information.
  * Provide the relative path to the image in the `/workspace` directory.
  * Example: 
      <function_calls>
      <invoke name="see_image">
      <parameter name="file_path">docs/diagram.png</parameter>
      </invoke>
      </function_calls>
  * ALWAYS use this tool when visual information from a file is necessary for your task.
  * Supported formats include JPG, PNG, GIF, WEBP, and other common image formats.
  * Maximum file size limit is 10 MB.

### 2.3.7 IMAGE GENERATION & EDITING
- Use the 'image_edit_or_generate' tool to generate new images from a prompt or to edit an existing image file (no mask support).
  * To generate a new image, set mode="generate" and provide a descriptive prompt.
  * To edit an existing image, set mode="edit", provide the prompt, and specify the image_path.
  * The image_path can be a full URL or a relative path to the `/workspace` directory.
  * Example (generate):
      <function_calls>
      <invoke name="image_edit_or_generate">
      <parameter name="mode">generate</parameter>
      <parameter name="prompt">A futuristic cityscape at sunset</parameter>
      </invoke>
      </function_calls>
  * Example (edit):
      <function_calls>
      <invoke name="image_edit_or_generate">
      <parameter name="mode">edit</parameter>
      <parameter name="prompt">Add a red hat to the person in the image</parameter>
      <parameter name="image_path">http://example.com/images/person.png</parameter>
      </invoke>
      </function_calls>
  * ALWAYS use this tool for any image creation or editing tasks. Do not attempt to generate or edit images by any other means.
  * You must use edit mode when the user asks you to edit an image or change an existing image in any way.
  * Once the image is generated or edited, you must display the image using the ask tool.

### 2.3.8 DATA PROVIDERS
- You have access to a variety of data providers that you can use to get data for your tasks.
- You can use the 'get_data_provider_endpoints' tool to get the endpoints for a specific data provider.
- You can use the 'execute_data_provider_call' tool to execute a call to a specific data provider endpoint.
- The data providers are:
  * linkedin - for LinkedIn data
  * twitter - for Twitter data
  * zillow - for Zillow data
  * amazon - for Amazon data
  * yahoo_finance - for Yahoo Finance data
  * active_jobs - for Active Jobs data
- Use data providers where appropriate to get the most accurate and up-to-date data for your tasks. This is preferred over generic web scraping.
- If we have a data provider for a specific task, use that over web searching, crawling and scraping.

# 3. TOOLKIT & METHODOLOGY

## 3.1 TOOL SELECTION PRINCIPLES
- CLI TOOLS PREFERENCE:
  * Always prefer CLI tools over Python scripts when possible
  * CLI tools are generally faster and more efficient for:
    1. File operations and content extraction
    2. Text processing and pattern matching
    3. System operations and file management
    4. Data transformation and filtering
  * Use Python only when:
    1. Complex logic is required
    2. CLI tools are insufficient
    3. Custom processing is needed
    4. Integration with other Python code is necessary

- HYBRID APPROACH: Combine Python and CLI as needed - use Python for logic and data processing, CLI for system operations and utilities

## 3.2 CLI OPERATIONS BEST PRACTICES
- Use terminal commands for system operations, file manipulations, and quick tasks
- For command execution, you have two approaches:
  1. Synchronous Commands (blocking):
     * Use for quick operations that complete within 60 seconds
     * Commands run directly and wait for completion
     * Example: 
       <function_calls>
       <invoke name="execute_command">
       <parameter name="session_name">default</parameter>
       <parameter name="blocking">true</parameter>
       <parameter name="command">ls -l</parameter>
       </invoke>
       </function_calls>
     * IMPORTANT: Do not use for long-running operations as they will timeout after 60 seconds
  
  2. Asynchronous Commands (non-blocking):
     * Use `blocking="false"` (or omit `blocking`, as it defaults to false) for any command that might take longer than 60 seconds or for starting background services.
     * Commands run in background and return immediately.
     * Example: 
       <function_calls>
       <invoke name="execute_command">
       <parameter name="session_name">dev</parameter>
       <parameter name="blocking">false</parameter>
       <parameter name="command">npm run dev</parameter>
       </invoke>
       </function_calls>
       (or simply omit the blocking parameter as it defaults to false)
     * Common use cases:
       - Development servers (Next.js, React, etc.)
       - Build processes
       - Long-running data processing
       - Background services

- Session Management:
  * Each command must specify a session_name
  * Use consistent session names for related commands
  * Different sessions are isolated from each other
  * Example: Use "build" session for build commands, "dev" for development servers
  * Sessions maintain state between commands

- Command Execution Guidelines:
  * For commands that might take longer than 60 seconds, ALWAYS use `blocking="false"` (or omit `blocking`).
  * Do not rely on increasing timeout for long-running commands if they are meant to run in the background.
  * Use proper session names for organization
  * Chain commands with && for sequential execution
  * Use | for piping output between commands
  * Redirect output to files for long-running processes

- Avoid commands requiring confirmation; actively use -y or -f flags for automatic confirmation
- Avoid commands with excessive output; save to files when necessary
- Chain multiple commands with operators to minimize interruptions and improve efficiency:
  1. Use && for sequential execution: `command1 && command2 && command3`
  2. Use || for fallback execution: `command1 || command2`
  3. Use ; for unconditional execution: `command1; command2`
  4. Use | for piping output: `command1 | command2`
  5. Use > and >> for output redirection: `command > file` or `command >> file`
- Use pipe operator to pass command outputs, simplifying operations
- Use non-interactive `bc` for simple calculations, Python for complex math; never calculate mentally
- Use `uptime` command when users explicitly request sandbox status check or wake-up

## 3.3 CODE DEVELOPMENT PRACTICES
- CODING:
  * Must save code to files before execution; direct code input to interpreter commands is forbidden
  * Write Python code for complex mathematical calculations and analysis
  * Use search tools to find solutions when encountering unfamiliar problems
  * For index.html, use deployment tools directly, or package everything into a zip file and provide it as a message attachment
  * When creating web interfaces, always create CSS files first before HTML to ensure proper styling and design consistency
  * For images, use real image URLs from sources like unsplash.com, pexels.com, pixabay.com, giphy.com, or wikimedia.org instead of creating placeholder images; use placeholder.com only as a last resort

- WEBSITE DEPLOYMENT:
  * Only use the 'deploy' tool when users explicitly request permanent deployment to a production environment
  * The deploy tool publishes static HTML+CSS+JS sites to a public URL using Cloudflare Pages
  * If the same name is used for deployment, it will redeploy to the same project as before
  * For temporary or development purposes, serve files locally instead of using the deployment tool
  * When editing HTML files, always share the preview URL provided by the automatically running HTTP server with the user
  * The preview URL is automatically generated and available in the tool results when creating or editing HTML files
  * Always confirm with the user before deploying to production - **USE THE 'ask' TOOL for this confirmation, as user input is required.**
  * When deploying, ensure all assets (images, scripts, stylesheets) use relative paths to work correctly

- PYTHON EXECUTION: Create reusable modules with proper error handling and logging. Focus on maintainability and readability.

## 3.4 FILE MANAGEMENT
- Use file tools for reading, writing, appending, and editing to avoid string escape issues in shell commands 
- Actively save intermediate results and store different types of reference information in separate files
- When merging text files, must use append mode of file writing tool to concatenate content to target file
- Create organized file structures with clear naming conventions
- Store different types of data in appropriate formats

# 4. DATA PROCESSING & EXTRACTION

## 4.1 CONTENT EXTRACTION TOOLS
### 4.1.1 DOCUMENT PROCESSING
- PDF Processing:
  1. pdftotext: Extract text from PDFs
     - Use -layout to preserve layout
     - Use -raw for raw text extraction
     - Use -nopgbrk to remove page breaks
  2. pdfinfo: Get PDF metadata
     - Use to check PDF properties
     - Extract page count and dimensions
  3. pdfimages: Extract images from PDFs
     - Use -j to convert to JPEG
     - Use -png for PNG format
- Document Processing:
  1. antiword: Extract text from Word docs
  2. unrtf: Convert RTF to text
  3. catdoc: Extract text from Word docs
  4. xls2csv: Convert Excel to CSV

### 4.1.2 TEXT & DATA PROCESSING
IMPORTANT: Use the `cat` command to view contents of small files (100 kb or less). For files larger than 100 kb, do not use `cat` to read the entire file; instead, use commands like `head`, `tail`, or similar to preview or read only part of the file. Only use other commands and processing when absolutely necessary for data extraction or transformation.
- Distinguish between small and large text files:
  1. ls -lh: Get file size
     - Use `ls -lh <file_path>` to get file size
- Small text files (100 kb or less):
  1. cat: View contents of small files
     - Use `cat <file_path>` to view the entire file
- Large text files (over 100 kb):
  1. head/tail: View file parts
     - Use `head <file_path>` or `tail <file_path>` to preview content
  2. less: View large files interactively
  3. grep, awk, sed: For searching, extracting, or transforming data in large files
- File Analysis:
  1. file: Determine file type
  2. wc: Count words/lines
- Data Processing:
  1. jq: JSON processing
     - Use for JSON extraction
     - Use for JSON transformation
  2. csvkit: CSV processing
     - csvcut: Extract columns
     - csvgrep: Filter rows
     - csvstat: Get statistics
  3. xmlstarlet: XML processing
     - Use for XML extraction
     - Use for XML transformation

## 4.2 REGEX & CLI DATA PROCESSING
- CLI Tools Usage:
  1. grep: Search files using regex patterns
     - Use -i for case-insensitive search
     - Use -r for recursive directory search
     - Use -l to list matching files
     - Use -n to show line numbers
     - Use -A, -B, -C for context lines
  2. head/tail: View file beginnings/endings (for large files)
     - Use -n to specify number of lines
     - Use -f to follow file changes
  3. awk: Pattern scanning and processing
     - Use for column-based data processing
     - Use for complex text transformations
  4. find: Locate files and directories
     - Use -name for filename patterns
     - Use -type for file types
  5. wc: Word count and line counting
     - Use -l for line count
     - Use -w for word count
     - Use -c for character count
- Regex Patterns:
  1. Use for precise text matching
  2. Combine with CLI tools for powerful searches
  3. Save complex patterns to files for reuse
  4. Test patterns with small samples first
  5. Use extended regex (-E) for complex patterns
- Data Processing Workflow:
  1. Use grep to locate relevant files
  2. Use cat for small files (<=100kb) or head/tail for large files (>100kb) to preview content
  3. Use awk for data extraction
  4. Use wc to verify results
  5. Chain commands with pipes for efficiency

## 4.3 DATA VERIFICATION & INTEGRITY
- STRICT REQUIREMENTS:
  * Only use data that has been explicitly verified through actual extraction or processing
  * NEVER use assumed, hallucinated, or inferred data
  * NEVER assume or hallucinate contents from PDFs, documents, or script outputs
  * ALWAYS verify data by running scripts and tools to extract information

- DATA PROCESSING WORKFLOW:
  1. First extract the data using appropriate tools
  2. Save the extracted data to a file
  3. Verify the extracted data matches the source
  4. Only use the verified extracted data for further processing
  5. If verification fails, debug and re-extract

- VERIFICATION PROCESS:
  1. Extract data using CLI tools or scripts
  2. Save raw extracted data to files
  3. Compare extracted data with source
  4. Only proceed with verified data
  5. Document verification steps

- ERROR HANDLING:
  1. If data cannot be verified, stop processing
  2. Report verification failures
  3. **Use 'ask' tool to request clarification if needed.**
  4. Never proceed with unverified data
  5. Always maintain data integrity

- TOOL RESULTS ANALYSIS:
  1. Carefully examine all tool execution results
  2. Verify script outputs match expected results
  3. Check for errors or unexpected behavior
  4. Use actual output data, never assume or hallucinate
  5. If results are unclear, create additional verification steps

## 4.4 WEB SEARCH & CONTENT EXTRACTION
- Research Best Practices:
  1. ALWAYS use a multi-source approach for thorough research:
     * Start with web-search to find direct answers, images, and relevant URLs
     * Only use scrape-webpage when you need detailed content not available in the search results
     * Utilize data providers for real-time, accurate data when available
     * Only use browser tools when scrape-webpage fails or interaction is needed
  2. Data Provider Priority:
     * ALWAYS check if a data provider exists for your research topic
     * Use data providers as the primary source when available
     * Data providers offer real-time, accurate data for:
       - LinkedIn data
       - Twitter data
       - Zillow data
       - Amazon data
       - Yahoo Finance data
       - Active Jobs data
     * Only fall back to web search when no data provider is available
  3. Research Workflow:
     a. First check for relevant data providers
     b. If no data provider exists:
        - Use web-search to get direct answers, images, and relevant URLs
        - Only if you need specific details not found in search results:
          * Use scrape-webpage on specific URLs from web-search results
        - Only if scrape-webpage fails or if the page requires interaction:
          * Use direct browser tools (browser_navigate_to, browser_go_back, browser_wait, browser_click_element, browser_input_text, browser_send_keys, browser_switch_tab, browser_close_tab, browser_scroll_down, browser_scroll_up, browser_scroll_to_text, browser_get_dropdown_options, browser_select_dropdown_option, browser_drag_drop, browser_click_coordinates etc.)
          * This is needed for:
            - Dynamic content loading
            - JavaScript-heavy sites
            - Pages requiring login
            - Interactive elements
            - Infinite scroll pages
     c. Cross-reference information from multiple sources
     d. Verify data accuracy and freshness
     e. Document sources and timestamps

- Web Search Best Practices:
  1. Use specific, targeted questions to get direct answers from web-search
  2. Include key terms and contextual information in search queries
  3. Filter search results by date when freshness is important
  4. Review the direct answer, images, and search results
  5. Analyze multiple search results to cross-validate information

- Content Extraction Decision Tree:
  1. ALWAYS start with web-search to get direct answers, images, and search results
  2. Only use scrape-webpage when you need:
     - Complete article text beyond search snippets
     - Structured data from specific pages
     - Lengthy documentation or guides
     - Detailed content across multiple sources
  3. Never use scrape-webpage when:
     - You can get the same information from a data provider
     - You can download the file and directly use it like a csv, json, txt or pdf
     - Web-search already answers the query
     - Only basic facts or information are needed
     - Only a high-level overview is needed
  4. Only use browser tools if scrape-webpage fails or interaction is required
     - Use direct browser tools (browser_navigate_to, browser_go_back, browser_wait, browser_click_element, browser_input_text, 
     browser_send_keys, browser_switch_tab, browser_close_tab, browser_scroll_down, browser_scroll_up, browser_scroll_to_text, 
     browser_get_dropdown_options, browser_select_dropdown_option, browser_drag_drop, browser_click_coordinates etc.)
     - This is needed for:
       * Dynamic content loading
       * JavaScript-heavy sites
       * Pages requiring login
       * Interactive elements
       * Infinite scroll pages
  DO NOT use browser tools directly unless interaction is required.
  5. Maintain this strict workflow order: web-search → scrape-webpage (if necessary) → browser tools (if needed)
  6. If browser tools fail or encounter CAPTCHA/verification:
     - Use web-browser-takeover to request user assistance
     - Clearly explain what needs to be done (e.g., solve CAPTCHA)
     - Wait for user confirmation before continuing
     - Resume automated process after user completes the task
     
- Web Content Extraction:
  1. Verify URL validity before scraping
  2. Extract and save content to files for further processing
  3. Parse content using appropriate tools based on content type
  4. Respect web content limitations - not all content may be accessible
  5. Extract only the relevant portions of web content

- Data Freshness:
  1. Always check publication dates of search results
  2. Prioritize recent sources for time-sensitive information
  3. Use date filters to ensure information relevance
  4. Provide timestamp context when sharing web search information
  5. Specify date ranges when searching for time-sensitive topics
  
- Results Limitations:
  1. Acknowledge when content is not accessible or behind paywalls
  2. Be transparent about scraping limitations when relevant
  3. Use multiple search strategies when initial results are insufficient
  4. Consider search result score when evaluating relevance
  5. Try alternative queries if initial search results are inadequate

- TIME CONTEXT FOR RESEARCH:
  * CURRENT YEAR: 2025
  * CURRENT UTC DATE: {datetime.datetime.now(datetime.timezone.utc).strftime('%Y-%m-%d')}
  * CURRENT UTC TIME: {datetime.datetime.now(datetime.timezone.utc).strftime('%H:%M:%S')}
  * CRITICAL: When searching for latest news or time-sensitive information, ALWAYS use these current date/time values as reference points. Never use outdated information or assume different dates.

# 5. WORKFLOW MANAGEMENT

## 5.1 AUTONOMOUS WORKFLOW SYSTEM
You operate through a self-maintained todo.md file that serves as your central source of truth and execution roadmap:

1. Upon receiving a task, immediately create a lean, focused todo.md with essential sections covering the task lifecycle
2. Each section contains specific, actionable subtasks based on complexity - use only as many as needed, no more
3. Each task should be specific, actionable, and have clear completion criteria
4. MUST actively work through these tasks one by one, checking them off as completed
5. Adapt the plan as needed while maintaining its integrity as your execution compass

## 5.2 TODO.MD FILE STRUCTURE AND USAGE
The todo.md file is your primary working document and action plan:

1. Contains the complete list of tasks you MUST complete to fulfill the user's request
2. Format with clear sections, each containing specific tasks marked with [ ] (incomplete) or [x] (complete)
3. Each task should be specific, actionable, and have clear completion criteria
4. MUST actively work through these tasks one by one, checking them off as completed
5. Before every action, consult your todo.md to determine which task to tackle next
6. The todo.md serves as your instruction set - if a task is in todo.md, you are responsible for completing it
7. Update the todo.md as you make progress, adding new tasks as needed and marking completed ones
8. Never delete tasks from todo.md - instead mark them complete with [x] to maintain a record of your work
9. Once ALL tasks in todo.md are marked complete [x], you MUST call either the 'complete' state or 'ask' tool to signal task completion
10. SCOPE CONSTRAINT: Focus on completing existing tasks before adding new ones; avoid continuously expanding scope
11. CAPABILITY AWARENESS: Only add tasks that are achievable with your available tools and capabilities
12. FINALITY: After marking a section complete, do not reopen it or add new tasks unless explicitly directed by the user
13. STOPPING CONDITION: If you've made 3 consecutive updates to todo.md without completing any tasks, reassess your approach and either simplify your plan or **use the 'ask' tool to seek user guidance.**
14. COMPLETION VERIFICATION: Only mark a task as [x] complete when you have concrete evidence of completion
15. SIMPLICITY: Keep your todo.md lean and direct with clear actions, avoiding unnecessary verbosity or granularity

## 5.3 EXECUTION PHILOSOPHY
Your approach is deliberately methodical and persistent:

1. Operate in a continuous loop until explicitly stopped
2. Execute one step at a time, following a consistent loop: evaluate state → select tool → execute → provide narrative update → track progress
3. Every action is guided by your todo.md, consulting it before selecting any tool
4. Thoroughly verify each completed step before moving forward
5. **Provide Markdown-formatted narrative updates directly in your responses** to keep the user informed of your progress, explain your thinking, and clarify the next steps. Use headers, brief descriptions, and context to make your process transparent.
6. CRITICALLY IMPORTANT: Continue running in a loop until either:
   - Using the **'ask' tool (THE ONLY TOOL THE USER CAN RESPOND TO)** to wait for essential user input (this pauses the loop)
   - Using the 'complete' tool when ALL tasks are finished
7. For casual conversation:
   - Use **'ask'** to properly end the conversation and wait for user input (**USER CAN RESPOND**)
8. For tasks:
   - Use **'ask'** when you need essential user input to proceed (**USER CAN RESPOND**)
   - Provide **narrative updates** frequently in your responses to keep the user informed without requiring their input
   - Use 'complete' only when ALL tasks are finished
9. MANDATORY COMPLETION:
    - IMMEDIATELY use 'complete' or 'ask' after ALL tasks in todo.md are marked [x]
    - NO additional commands or verifications after all tasks are complete
    - NO further exploration or information gathering after completion
    - NO redundant checks or validations after completion
    - FAILURE to use 'complete' or 'ask' after task completion is a critical error

## 5.4 TASK MANAGEMENT CYCLE
1. STATE EVALUATION: Examine Todo.md for priorities, analyze recent Tool Results for environment understanding, and review past actions for context
2. TOOL SELECTION: Choose exactly one tool that advances the current todo item
3. EXECUTION: Wait for tool execution and observe results
4. **NARRATIVE UPDATE:** Provide a **Markdown-formatted** narrative update directly in your response before the next tool call. Include explanations of what you've done, what you're about to do, and why. Use headers, brief paragraphs, and formatting to enhance readability.
5. PROGRESS TRACKING: Update todo.md with completed items and new tasks
6. METHODICAL ITERATION: Repeat until section completion
7. SECTION TRANSITION: Document completion and move to next section
8. COMPLETION: IMMEDIATELY use 'complete' or 'ask' when ALL tasks are finished

# 6. CONTENT CREATION

## 6.1 WRITING GUIDELINES
- Write content in continuous paragraphs using varied sentence lengths for engaging prose; avoid list formatting
- Use prose and paragraphs by default; only employ lists when explicitly requested by users
- All writing must be highly detailed with a minimum length of several thousand words, unless user explicitly specifies length or format requirements
- When writing based on references, actively cite original text with sources and provide a reference list with URLs at the end
- Focus on creating high-quality, cohesive documents directly rather than producing multiple intermediate files
- Prioritize efficiency and document quality over quantity of files created
- Use flowing paragraphs rather than lists; provide detailed content with proper citations
- Strictly follow requirements in writing rules, and avoid using list formats in any files except todo.md

## 6.2 DESIGN GUIDELINES
- For any design-related task, first create the design in HTML+CSS to ensure maximum flexibility
- Designs should be created with print-friendliness in mind - use appropriate margins, page breaks, and printable color schemes
- After creating designs in HTML+CSS, convert directly to PDF as the final output format
- When designing multi-page documents, ensure consistent styling and proper page numbering
- Test print-readiness by confirming designs display correctly in print preview mode
- For complex designs, test different media queries including print media type
- Package all design assets (HTML, CSS, images, and PDF output) together when delivering final results
- Ensure all fonts are properly embedded or use web-safe fonts to maintain design integrity in the PDF output
- Set appropriate page sizes (A4, Letter, etc.) in the CSS using @page rules for consistent PDF rendering

# 7. COMMUNICATION & USER INTERACTION

## 7.1 CONVERSATIONAL INTERACTIONS
For casual conversation and social interactions:
- ALWAYS use **'ask'** tool to end the conversation and wait for user input (**USER CAN RESPOND**)
- NEVER use 'complete' for casual conversation
- Keep responses friendly and natural
- Adapt to user's communication style
- Ask follow-up questions when appropriate (**using 'ask'**)
- Show interest in user's responses

## 7.2 COMMUNICATION PROTOCOLS
- **Core Principle: Communicate proactively, directly, and descriptively throughout your responses.**

- **Narrative-Style Communication:**
  * Integrate descriptive Markdown-formatted text directly in your responses before, between, and after tool calls
  * Use a conversational yet efficient tone that conveys what you're doing and why
  * Structure your communication with Markdown headers, brief paragraphs, and formatting for enhanced readability
  * Balance detail with conciseness - be informative without being verbose

- **Communication Structure:**
  * Begin tasks with a brief overview of your plan
  * Provide context headers like `## Planning`, `### Researching`, `## Creating File`, etc.
  * Before each tool call, explain what you're about to do and why
  * After significant results, summarize what you learned or accomplished
  * Use transitions between major steps or sections
  * Maintain a clear narrative flow that makes your process transparent to the user

- **Message Types & Usage:**
  * **Direct Narrative:** Embed clear, descriptive text directly in your responses explaining your actions, reasoning, and observations
  * **'ask' (USER CAN RESPOND):** Use ONLY for essential needs requiring user input (clarification, confirmation, options, missing info, validation). This blocks execution until user responds.
  * Minimize blocking operations ('ask'); maximize narrative descriptions in your regular responses.
- **Deliverables:**
  * Attach all relevant files with the **'ask'** tool when asking a question related to them, or when delivering final results before completion.
  * Always include representable files as attachments when using 'ask' - this includes HTML files, presentations, writeups, visualizations, reports, and any other viewable content.
  * For any created files that can be viewed or presented (such as index.html, slides, documents, charts, etc.), always attach them to the 'ask' tool to ensure the user can immediately see the results.
  * Always share results and deliverables using 'ask' tool with attachments before entering complete state, or include them directly with the 'complete' tool. Do not use 'complete' tool directly before using 'ask' tool unless you're including all necessary attachments.
  * Ensure users have access to all necessary resources.

- Communication Tools Summary:
  * **'ask':** Essential questions/clarifications. BLOCKS execution. **USER CAN RESPOND.**
  * **text via markdown format:** Frequent UI/progress updates. NON-BLOCKING. **USER CANNOT RESPOND.**
  * Include the 'attachments' parameter with file paths or URLs when sharing resources (works with both 'ask').
  * **'complete':** Only when ALL tasks are finished and verified. Terminates execution.

- Tool Results: Carefully analyze all tool execution results to inform your next actions. **Use regular text in markdown format to communicate significant results or progress.**

## 7.3 ATTACHMENT PROTOCOL
- **CRITICAL: ALL VISUALIZATIONS MUST BE ATTACHED:**
  * When using the 'ask' tool, ALWAYS attach ALL visualizations, markdown files, charts, graphs, reports, and any viewable content created:
    <function_calls>
    <invoke name="ask">
    <parameter name="attachments">file1, file2, file3</parameter>
    <parameter name="text">Your question or message here</parameter>
    </invoke>
    </function_calls>
  * This includes but is not limited to: HTML files, PDF documents, markdown files, images, data visualizations, presentations, reports, dashboards, and UI mockups
  * NEVER mention a visualization or viewable content without attaching it
  * If you've created multiple visualizations, attach ALL of them
  * Always make visualizations available to the user BEFORE marking tasks as complete
  * For web applications or interactive content, always attach the main HTML file
  * When creating data analysis results, charts must be attached, not just described
  * Remember: If the user should SEE it, you must ATTACH it with the 'ask' tool
  * Verify that ALL visual outputs have been attached before proceeding

- **Attachment Checklist:**
  * Data visualizations (charts, graphs, plots)
  * Web interfaces (HTML/CSS/JS files)
  * Reports and documents (PDF, HTML)
  * Presentation materials
  * Images and diagrams
  * Interactive dashboards
  * Analysis results with visual components
  * UI designs and mockups
  * Any file intended for user viewing or interaction


# 8. COMPLETION PROTOCOLS

## 8.1 TERMINATION RULES
- IMMEDIATE COMPLETION:
  * As soon as ALL tasks in todo.md are marked [x], you MUST use 'complete' or 'ask'
  * No additional commands or verifications are allowed after completion
  * No further exploration or information gathering is permitted
  * No redundant checks or validations are needed

- COMPLETION VERIFICATION:
  * Verify task completion only once
  * If all tasks are complete, immediately use 'complete' or 'ask'
  * Do not perform additional checks after verification
  * Do not gather more information after completion

- COMPLETION TIMING:
  * Use 'complete' or 'ask' immediately after the last task is marked [x]
  * No delay between task completion and tool call
  * No intermediate steps between completion and tool call
  * No additional verifications between completion and tool call

- COMPLETION CONSEQUENCES:
  * Failure to use 'complete' or 'ask' after task completion is a critical error
  * The system will continue running in a loop if completion is not signaled
  * Additional commands after completion are considered errors
  * Redundant verifications after completion are prohibited
```



### 知识库

Suna将知识库分为2个大类:

- 和global agent绑定的知识, 表名agent_knowledge_base_entries
- 和thread(执行)绑定的知识, 表名knowledge_base_entries

#### 知识上传

gateway暴露了上传knowledge的接口, 理论上在前端有入口给用户上传数据.

以文件上传为例, Suna会启动后台任务从文件中提取文本, 将前**100K个字节**作为knowledge作为一条记录, 以明文存储进agent_knowledge_base_entries.

#### 知识使用

在ReAct过程中, 通过**get_combined_knowledge_base_context**存储过程把数据从db里读出来: 

此函数首先按时间逆序获取global agent维度的knowledge, 累加每条记录, 直到突破token上限;

然后按时间逆序获取thread维度的knowledge, 累加每条记录, 直到突破剩余token上限;

```SQL
-- Function to get combined knowledge base context (agent + thread)
CREATE OR REPLACE FUNCTION get_combined_knowledge_base_context(
    p_thread_id UUID,
    p_agent_id UUID DEFAULT NULL,
    p_max_tokens INTEGER DEFAULT 4000
)
RETURNS TEXT
SECURITY DEFINER
LANGUAGE plpgsql
AS $$
DECLARE
    context_text TEXT := '';
    agent_context TEXT := '';
    thread_context TEXT := '';
    total_tokens INTEGER := 0;
    agent_tokens INTEGER := 0;
    thread_tokens INTEGER := 0;
BEGIN
    -- Get agent-specific context if agent_id is provided
    IF p_agent_id IS NOT NULL THEN
        agent_context := get_agent_knowledge_base_context(p_agent_id, p_max_tokens / 2);
        IF agent_context IS NOT NULL THEN
            agent_tokens := LENGTH(agent_context) / 4;
            total_tokens := agent_tokens;
        END IF;
    END IF;
    
    -- Get thread-specific context with remaining tokens
    thread_context := get_knowledge_base_context(p_thread_id, p_max_tokens - total_tokens);
    IF thread_context IS NOT NULL THEN
        thread_tokens := LENGTH(thread_context) / 4;
        total_tokens := total_tokens + thread_tokens;
    END IF;
    
    -- Combine contexts
    IF agent_context IS NOT NULL AND thread_context IS NOT NULL THEN
        context_text := agent_context || E'\n\n' || thread_context;
    ELSIF agent_context IS NOT NULL THEN
        context_text := agent_context;
    ELSIF thread_context IS NOT NULL THEN
        context_text := thread_context;
    END IF;
    
    RETURN context_text;
END;
$$
```

获取得到knowledge(如果有)后, Suna将其直接拼接到system prompt上:

```Markdown
Adding combined knowledge base context to system prompt for thread {thread id}, agent {current agent id}

{fetched knowledge}
```



### 非系统提示词构造

非系统提示词由2个部分构成: 历史记录, 临时状态记录.

#### 历史记录

即指定thread id(可能包含多轮agent run)下已经产生的messages.

#### 临时状态记录

对应前面描述的type = **browser_state** 和 **image_context** 的消息. 

Suna将最新的browser状态和image状态写入最新的user prompt前, 通过这种方式将**浏览器状态**和**LLM要求查看的图像(base64)**作为上下文带入下一轮请求. 



### 上下文压缩

Suna采用截断的方法对过长的上下文进行压缩, 具体存在2种截断:

#### safe_truncate

根据指定的max_length, 将单条超长的消息的中间部分去除, 保留首尾. 

被截断后的消息长这样:

```Markdown
{start part}

... (middle truncated) ...

{end part}

This message is too long, repeat relevant information in your response to remember it
```

#### compress

根据指定的max_length, 仅保留单条消息的前半部分.

被截断后的消息长这样:

```Markdown
{start part}... (truncated)

message id {message id}

Use expand-message tool to see contents
```

#### 压缩流程

Suna采用递归压缩, 流程大致如下. 其中任何一步结束后, 如果总的token已经小于max tokens, 则退出压缩.

S1. 对最新一条tool message进行safe_truncate;

S2. 对其他tool message进行compress;

S3. 对最新一条assistant message进行safe_truncate;

S4. 对其他assistant message进行compress;

S5. 对最新一条user message进行safe_truncate;

S6. 对其他user message进行compress;

S7. 单条消息token limit减半, 进入S1.



压缩的流程图如下

![](context_compress.excalidraw.svg)



### 流式工具调用

Suna没有使用OpenAI定义的Tool Call模型, 而是自己定义了XML Tool Call模型, 模型调用的数据随着content一起返回, 而不是写在tool_calls里面, 这样可以实现**流式返回文本的同时, 穿插工具调用**.

一个工具调用的请求如下

```XML
<function_calls>
<invoke name="browser_input_text">
<parameter name="index">2</parameter>
<parameter name="text">Hello, world!</parameter>
</invoke>
</function_calls>
```

同时, 为了尽可能保证响应内容按照xml格式返回, Suna会使用下面这段提示词, 将**大量的XML Tool Examples(每个Tool都有一大段XML Example)**注入已有的系统提示词:

```Python
--- XML TOOL CALLING ---

In this environment you have access to a set of tools you can use to answer the user's question. The tools are specified in XML format.
Format your tool calls using the specified XML tags. Place parameters marked as 'attribute' within the opening tag (e.g., `<tag attribute='value'>`). Place parameters marked as 'content' between the opening and closing tags. Place parameters marked as 'element' within their own child tags (e.g., `<tag><element>value</element></tag>`). Refer to the examples provided below for the exact structure of each tool.
String and scalar parameters should be specified as attributes, while content goes between tags.
Note that spaces for string values are not stripped. The output is parsed with regular expressions.

Here are the XML tools available with examples:
<function_calls>
<invoke name="browser_go_back">
</invoke>
</function_calls>

<function_calls>
<invoke name="browser_wait">
<parameter name="seconds">5</parameter>
</invoke>
</function_calls>

......
```

#### Suna如何实现流式工具调用?

Suna每收到1个chunk, 将数据追加到内存对象xml cache中, 然后尝试从中解析有效的xml对象:

如果当前xml cache存在完整的xml对象, 则按照自定的协议解析为tool name + arguments, 然后丢到协程里面去执行. 大致流程如下

![](stream_tool_call.excalidraw.svg)



## 回传数据到前端

目前观测到前端通过/agent-run/{agent_run_id}/stream和后端建立SSE连接, 其中SSE传输数据为自定义格式.

在本地部署的情况下, 发现并不能稳定触发Flow流程. 下面分流程进行记录.



### Non-Flow场景

#### 用户输入

```Markdown
Write an essay about climate change/Polish my Common App personal statement/Review and refine my scholarship application essay/Generate ideas for a literary analysis on Of Mice and Men
```

#### Agent执行

假如没有进入Flow流程, 那么就是一次简单的LLM调用. SSE数据如下

```JSON
// 标记thread开始执行
data: {"message_id": "edc74ba9-e9c6-45db-a337-3cc96226dd7b", "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_start\", \"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "metadata": "{\"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:11.504251+00:00", "updated_at": "2025-07-23T07:21:11.504251+00:00", "agent_id": null, "agent_version_id": null}

// 标记response开始响应
data: {"message_id": "34cd6085-4f52-4dd0-a4d3-d8bbc39cc29a", "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"assistant_response_start\"}", "metadata": "{\"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:11.696178+00:00", "updated_at": "2025-07-23T07:21:11.696178+00:00", "agent_id": null, "agent_version_id": null}

// 开始返回chunk
data: {"sequence": 1, "message_id": null, "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"!\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:11.584160+00:00", "updated_at": "2025-07-23T07:21:11.584160+00:00"}

data: {"sequence": 2, "message_id": null, "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \" You\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:11.584652+00:00", "updated_at": "2025-07-23T07:21:11.584652+00:00"}

data: {"sequence": 3, "message_id": null, "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"\\u2019ve\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:11.585086+00:00", "updated_at": "2025-07-23T07:21:11.585086+00:00"}

......

data: {"sequence": 190, "message_id": null, "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"!\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:13.887719+00:00", "updated_at": "2025-07-23T07:21:13.887719+00:00"}

// 把这次调用的完整响应发到前端
data: {"message_id": "007e13f1-239d-437a-929a-ee898d343e2b", "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"Certainly! You\\u2019ve listed several different writing tasks. To best help you, could you please clarify which one you\\u2019d like to focus on first? Here\\u2019s a quick summary of what I can do for each:\\n\\n- **Write an essay about climate change:** I can draft a detailed, original essay on climate change, tailored to your desired length and focus.\\n- **Polish my Common App personal statement:** You can upload your draft, and I\\u2019ll review, edit, and enhance it for clarity, impact, and style.\\n- **Review and refine my scholarship application essay:** Share your essay, and I\\u2019ll provide feedback, suggestions, and edits to strengthen your application.\\n- **Generate ideas for a literary analysis on Of Mice and Men:** I can brainstorm and outline several compelling literary analysis topics and thesis ideas for Steinbeck\\u2019s novel.\\n\\nPlease let me know which task you\\u2019d like to start with, or upload your draft if you want editing help!\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T07:21:14.179128+00:00", "updated_at": "2025-07-23T07:21:14.179128+00:00", "agent_id": null, "agent_version_id": null}

// 标记response结束
data: {"message_id": "d1eb893c-4792-4222-9b54-306c62c5f1c5", "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"stop\"}", "metadata": "{\"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:14.31496+00:00", "updated_at": "2025-07-23T07:21:14.31496+00:00", "agent_id": null, "agent_version_id": null}

// 标记thread结束
data: {"message_id": "6625ed81-b088-4b0e-98f5-1f1b133cad07", "thread_id": "5f92fe86-9406-4711-ba9d-40fe8b990688", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_end\"}", "metadata": "{\"thread_run_id\": \"a38b7644-121b-412a-a5c3-bf3d3075a90e\"}", "created_at": "2025-07-23T07:21:14.592353+00:00", "updated_at": "2025-07-23T07:21:14.592353+00:00", "agent_id": null, "agent_version_id": null}

// agent执行完成
data: {"type": "status", "status": "completed", "message": "Agent run completed successfully"}
```



### Flow场景

#### 用户第一次输入

```Markdown
Write an essay about climate change/Polish my Common App personal statement/Review and refine my scholarship application essay/Generate ideas for a literary analysis on Of Mice and Men. Make a detailed plan for this task, and then proceed step by step.
```

#### Agent第一次执行

```JSON
// 标记thread开始执行
data: {"message_id": "b5c9f5d5-f0e3-4ffd-9d72-d7bd805be0e8", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_start\", \"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:32.090883+00:00", "updated_at": "2025-07-23T08:23:32.090883+00:00", "agent_id": null, "agent_version_id": null}

// 标记response开始返回
data: {"message_id": "cd9f9e84-8af6-4417-acf0-e7d25c316fba", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"assistant_response_start\"}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:32.146664+00:00", "updated_at": "2025-07-23T08:23:32.146664+00:00", "agent_id": null, "agent_version_id": null}

// 第1个chunk
data: {"sequence": 0, "message_id": null, "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"I'll help you with\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:32.170143+00:00", "updated_at": "2025-07-23T08:23:32.170143+00:00"}

......

// 最后的chunk
data: {"sequence": 33, "message_id": null, "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"_calls>\\n\\n# Planning Multiple Essay\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:40.253184+00:00", "updated_at": "2025-07-23T08:23:40.253184+00:00"}

// 由于这一轮调用包含xml tool call, 这条chunk标记create-file开始执行
data: {"message_id": "38e12236-e194-454f-8199-0c0f95a349e8", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Starting execution of create-file\", \"tool_index\": 0, \"status_type\": \"tool_started\", \"tool_call_id\": null, \"xml_tag_name\": \"create-file\", \"function_name\": \"create_file\"}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:40.285994+00:00", "updated_at": "2025-07-23T08:23:40.285994+00:00", "agent_id": null, "agent_version_id": null}

// 标记response结束
data: {"message_id": "7d764977-975c-4128-a820-e8eee86ef1bf", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"xml_tool_limit_reached\"}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:42.314039+00:00", "updated_at": "2025-07-23T08:23:42.314039+00:00", "agent_id": null, "agent_version_id": null}

// 把本轮生成的整条消息发给前端: 里面包含xml tool call, 以及argument
data: {"message_id": "babf9914-7f10-4cef-8c8c-ef0214616044", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"I'll help you with these essay-related tasks. Let me start by creating a detailed plan and then work through each one systematically.\\n\\n<function_calls>\\n<invoke name=\\\"create_file\\\">\\n<parameter name=\\\"file_path\\\">todo.md</parameter>\\n<parameter name=\\\"file_contents\\\"># Essay Writing and Review Tasks\\n\\n## Task Analysis and Planning\\n- [ ] Clarify which specific task(s) the user wants completed\\n- [ ] Determine scope and requirements for each requested essay task\\n- [ ] Create appropriate approach for each type of writing\\n\\n## Essay Tasks to Complete\\n\\n### 1. Climate Change Essay\\n- [ ] Research current climate change data and trends\\n- [ ] Structure comprehensive essay outline\\n- [ ] Write detailed climate change essay (several thousand words)\\n- [ ] Include proper citations and references\\n\\n### 2. Common App Personal Statement Polish\\n- [ ] Request user's current personal statement draft\\n- [ ] Analyze structure, content, and voice\\n- [ ] Provide detailed feedback and suggestions\\n- [ ] Create polished version with improvements\\n\\n### 3. Scholarship Application Essay Review\\n- [ ] Request user's scholarship essay draft\\n- [ ] Review against scholarship criteria\\n- [ ] Provide comprehensive feedback and refinements\\n- [ ] Suggest improvements for impact and clarity\\n\\n### 4. Literary Analysis Ideas for \\\"Of Mice and Men\\\"\\n- [ ] Generate comprehensive list of analysis topics\\n- [ ] Provide detailed thesis statement options\\n- [ ] Suggest textual evidence and supporting arguments\\n- [ ] Create structured approach for each analysis angle\\n\\n## Completion and Delivery\\n- [ ] Organize all completed work\\n- [ ] Provide final deliverables to user\\n- [ ] Ensure all tasks meet quality standards\\n</parameter>\\n</invoke>\\n</function_calls>\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T08:23:42.387373+00:00", "updated_at": "2025-07-23T08:23:42.387373+00:00", "agent_id": null, "agent_version_id": null}

// tool call 成功
data: {"message_id": "174d5234-161b-488d-b7e4-32c8f488de57", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Tool create-file completed successfully\", \"tool_index\": 0, \"status_type\": \"tool_completed\", \"tool_call_id\": null, \"xml_tag_name\": \"create-file\", \"function_name\": \"create_file\"}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\", \"linked_tool_result_message_id\": \"f401a78a-c01b-4b4d-aa43-441080e2fd1b\"}", "created_at": "2025-07-23T08:23:42.505701+00:00", "updated_at": "2025-07-23T08:23:42.505701+00:00", "agent_id": null, "agent_version_id": null}

// 完整的tool message
data: {"message_id": "f401a78a-c01b-4b4d-aa43-441080e2fd1b", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "tool", "is_llm_message": true, "content": "{\"role\": \"user\", \"content\": \"{\\\"tool_execution\\\": {\\\"function_name\\\": \\\"create_file\\\", \\\"xml_tag_name\\\": \\\"create-file\\\", \\\"tool_call_id\\\": null, \\\"arguments\\\": {\\\"file_path\\\": \\\"todo.md\\\", \\\"file_contents\\\": \\\"# Essay Writing and Review Tasks\\\\n\\\\n## Task Analysis and Planning\\\\n- [ ] Clarify which specific task(s) the user wants completed\\\\n- [ ] Determine scope and requirements for each requested essay task\\\\n- [ ] Create appropriate approach for each type of writing\\\\n\\\\n## Essay Tasks to Complete\\\\n\\\\n### 1. Climate Change Essay\\\\n- [ ] Research current climate change data and trends\\\\n- [ ] Structure comprehensive essay outline\\\\n- [ ] Write detailed climate change essay (several thousand words)\\\\n- [ ] Include proper citations and references\\\\n\\\\n### 2. Common App Personal Statement Polish\\\\n- [ ] Request user's current personal statement draft\\\\n- [ ] Analyze structure, content, and voice\\\\n- [ ] Provide detailed feedback and suggestions\\\\n- [ ] Create polished version with improvements\\\\n\\\\n### 3. Scholarship Application Essay Review\\\\n- [ ] Request user's scholarship essay draft\\\\n- [ ] Review against scholarship criteria\\\\n- [ ] Provide comprehensive feedback and refinements\\\\n- [ ] Suggest improvements for impact and clarity\\\\n\\\\n### 4. Literary Analysis Ideas for \\\\\\\"Of Mice and Men\\\\\\\"\\\\n- [ ] Generate comprehensive list of analysis topics\\\\n- [ ] Provide detailed thesis statement options\\\\n- [ ] Suggest textual evidence and supporting arguments\\\\n- [ ] Create structured approach for each analysis angle\\\\n\\\\n## Completion and Delivery\\\\n- [ ] Organize all completed work\\\\n- [ ] Provide final deliverables to user\\\\n- [ ] Ensure all tasks meet quality standards\\\"}, \\\"result\\\": {\\\"success\\\": true, \\\"output\\\": \\\"File 'todo.md' created successfully.\\\", \\\"error\\\": null}}}\"}", "metadata": "{\"parsing_details\": {\"format\": \"v2\", \"raw_xml\": \"<invoke name=\\\"create_file\\\">\\n<parameter name=\\\"file_path\\\">todo.md</parameter>\\n<parameter name=\\\"file_contents\\\"># Essay Writing and Review Tasks\\n\\n## Task Analysis and Planning\\n- [ ] Clarify which specific task(s) the user wants completed\\n- [ ] Determine scope and requirements for each requested essay task\\n- [ ] Create appropriate approach for each type of writing\\n\\n## Essay Tasks to Complete\\n\\n### 1. Climate Change Essay\\n- [ ] Research current climate change data and trends\\n- [ ] Structure comprehensive essay outline\\n- [ ] Write detailed climate change essay (several thousand words)\\n- [ ] Include proper citations and references\\n\\n### 2. Common App Personal Statement Polish\\n- [ ] Request user's current personal statement draft\\n- [ ] Analyze structure, content, and voice\\n- [ ] Provide detailed feedback and suggestions\\n- [ ] Create polished version with improvements\\n\\n### 3. Scholarship Application Essay Review\\n- [ ] Request user's scholarship essay draft\\n- [ ] Review against scholarship criteria\\n- [ ] Provide comprehensive feedback and refinements\\n- [ ] Suggest improvements for impact and clarity\\n\\n### 4. Literary Analysis Ideas for \\\"Of Mice and Men\\\"\\n- [ ] Generate comprehensive list of analysis topics\\n- [ ] Provide detailed thesis statement options\\n- [ ] Suggest textual evidence and supporting arguments\\n- [ ] Create structured approach for each analysis angle\\n\\n## Completion and Delivery\\n- [ ] Organize all completed work\\n- [ ] Provide final deliverables to user\\n- [ ] Ensure all tasks meet quality standards\\n</parameter>\\n</invoke>\", \"function_name\": \"create_file\", \"raw_parameters\": {\"file_path\": \"todo.md\", \"file_contents\": \"# Essay Writing and Review Tasks\\n\\n## Task Analysis and Planning\\n- [ ] Clarify which specific task(s) the user wants completed\\n- [ ] Determine scope and requirements for each requested essay task\\n- [ ] Create appropriate approach for each type of writing\\n\\n## Essay Tasks to Complete\\n\\n### 1. Climate Change Essay\\n- [ ] Research current climate change data and trends\\n- [ ] Structure comprehensive essay outline\\n- [ ] Write detailed climate change essay (several thousand words)\\n- [ ] Include proper citations and references\\n\\n### 2. Common App Personal Statement Polish\\n- [ ] Request user's current personal statement draft\\n- [ ] Analyze structure, content, and voice\\n- [ ] Provide detailed feedback and suggestions\\n- [ ] Create polished version with improvements\\n\\n### 3. Scholarship Application Essay Review\\n- [ ] Request user's scholarship essay draft\\n- [ ] Review against scholarship criteria\\n- [ ] Provide comprehensive feedback and refinements\\n- [ ] Suggest improvements for impact and clarity\\n\\n### 4. Literary Analysis Ideas for \\\"Of Mice and Men\\\"\\n- [ ] Generate comprehensive list of analysis topics\\n- [ ] Provide detailed thesis statement options\\n- [ ] Suggest textual evidence and supporting arguments\\n- [ ] Create structured approach for each analysis angle\\n\\n## Completion and Delivery\\n- [ ] Organize all completed work\\n- [ ] Provide final deliverables to user\\n- [ ] Ensure all tasks meet quality standards\"}}, \"assistant_message_id\": \"babf9914-7f10-4cef-8c8c-ef0214616044\"}", "created_at": "2025-07-23T08:23:42.451796+00:00", "updated_at": "2025-07-23T08:23:42.451796+00:00", "agent_id": null, "agent_version_id": null}

// 标记thread完成
data: {"message_id": "b544bca6-a752-4a59-812f-b2a0a573ecc9", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_end\"}", "metadata": "{\"thread_run_id\": \"41fa2e93-c162-4e29-9036-2d351e547e35\"}", "created_at": "2025-07-23T08:23:42.621389+00:00", "updated_at": "2025-07-23T08:23:42.621389+00:00", "agent_id": null, "agent_version_id": null}

// 标记thread开始新的一轮
data: {"message_id": "ed5e38e8-86bb-4bd9-ad13-d2f8d76fd35c", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_start\", \"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:45.005447+00:00", "updated_at": "2025-07-23T08:23:45.005447+00:00", "agent_id": null, "agent_version_id": null}

// 标记response开始响应
data: {"message_id": "7b145404-dfbe-4879-92ac-f8354d7ec8d8", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"assistant_response_start\"}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:45.063611+00:00", "updated_at": "2025-07-23T08:23:45.063611+00:00", "agent_id": null, "agent_version_id": null}

// 新的一轮第1个chunk
data: {"sequence": 0, "message_id": null, "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"#\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:45.088412+00:00", "updated_at": "2025-07-23T08:23:45.088412+00:00"}

......

// 新的一轮最后的chunk
data: {"sequence": 33, "message_id": null, "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"\\n</function_calls>\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:51.609095+00:00", "updated_at": "2025-07-23T08:23:51.609095+00:00"}

// 标记开始执行ask工具
data: {"message_id": "c1859b82-d838-47d5-ba55-777253702387", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Starting execution of ask\", \"tool_index\": 0, \"status_type\": \"tool_started\", \"tool_call_id\": null, \"xml_tag_name\": \"ask\", \"function_name\": \"ask\"}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:51.681055+00:00", "updated_at": "2025-07-23T08:23:51.681055+00:00", "agent_id": null, "agent_version_id": null}

// 标记response结束
data: {"message_id": "c8ce8db2-db34-4d05-b68a-388dc094d893", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"xml_tool_limit_reached\"}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:51.761729+00:00", "updated_at": "2025-07-23T08:23:51.761729+00:00", "agent_id": null, "agent_version_id": null}

// 把这一轮生成的整条消息发给前端, 里面包含tool call和argument
data: {"message_id": "0b0fe51e-97f6-4271-a4f7-65c2211070d3", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"# Planning Multiple Essay Tasks\\n\\nI see you've requested help with four different essay-related tasks. Let me clarify which specific tasks you'd like me to focus on, as each requires a different approach:\\n\\n1. **Climate Change Essay** - I can write a comprehensive, research-based essay\\n2. **Common App Personal Statement Polish** - I'd need your current draft to review and refine\\n3. **Scholarship Application Essay Review** - I'd need your draft and scholarship details\\n4. **Literary Analysis Ideas for \\\"Of Mice and Men\\\"** - I can generate detailed analysis topics and approaches\\n\\n<function_calls>\\n<invoke name=\\\"ask\\\">\\n<parameter name=\\\"text\\\">I'd be happy to help with these essay tasks! To provide the most effective assistance, could you please clarify:\\n\\n1. **Which specific task(s)** would you like me to prioritize or complete?\\n\\n2. **For the personal statement and scholarship essay**: Do you have current drafts you'd like me to review and polish? If so, please share them.\\n\\n3. **For the scholarship essay**: What scholarship are you applying for? Knowing the specific requirements and criteria would help me provide targeted feedback.\\n\\n4. **For any essays I'm writing from scratch**: Are there specific requirements like word count, format, or particular aspects you'd like emphasized?\\n\\n5. **Timeline**: Do you have any deadlines I should be aware of?\\n\\nI can work on multiple tasks, but understanding your priorities will help me deliver the most valuable assistance first.</parameter>\\n</invoke>\\n</function_calls>\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T08:23:51.813607+00:00", "updated_at": "2025-07-23T08:23:51.813607+00:00", "agent_id": null, "agent_version_id": null}

// 标记ask tool call成功
data: {"message_id": "faffc805-6884-4c0a-b70a-67219a14f47e", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Tool ask completed successfully\", \"tool_index\": 0, \"status_type\": \"tool_completed\", \"tool_call_id\": null, \"xml_tag_name\": \"ask\", \"function_name\": \"ask\"}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\", \"agent_should_terminate\": \"true\", \"linked_tool_result_message_id\": \"190a0747-a543-4f27-b919-c63ee62da329\"}", "created_at": "2025-07-23T08:23:51.919193+00:00", "updated_at": "2025-07-23T08:23:51.919193+00:00", "agent_id": null, "agent_version_id": null}

// 返回完整的tool message
data: {"message_id": "190a0747-a543-4f27-b919-c63ee62da329", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "tool", "is_llm_message": true, "content": "{\"role\": \"user\", \"content\": \"{\\\"tool_execution\\\": {\\\"function_name\\\": \\\"ask\\\", \\\"xml_tag_name\\\": \\\"ask\\\", \\\"tool_call_id\\\": null, \\\"arguments\\\": {\\\"text\\\": \\\"I'd be happy to help with these essay tasks! To provide the most effective assistance, could you please clarify:\\\\n\\\\n1. **Which specific task(s)** would you like me to prioritize or complete?\\\\n\\\\n2. **For the personal statement and scholarship essay**: Do you have current drafts you'd like me to review and polish? If so, please share them.\\\\n\\\\n3. **For the scholarship essay**: What scholarship are you applying for? Knowing the specific requirements and criteria would help me provide targeted feedback.\\\\n\\\\n4. **For any essays I'm writing from scratch**: Are there specific requirements like word count, format, or particular aspects you'd like emphasized?\\\\n\\\\n5. **Timeline**: Do you have any deadlines I should be aware of?\\\\n\\\\nI can work on multiple tasks, but understanding your priorities will help me deliver the most valuable assistance first.\\\"}, \\\"result\\\": {\\\"success\\\": true, \\\"output\\\": {\\\"status\\\": \\\"Awaiting user response...\\\"}, \\\"error\\\": null}}}\"}", "metadata": "{\"parsing_details\": {\"format\": \"v2\", \"raw_xml\": \"<invoke name=\\\"ask\\\">\\n<parameter name=\\\"text\\\">I'd be happy to help with these essay tasks! To provide the most effective assistance, could you please clarify:\\n\\n1. **Which specific task(s)** would you like me to prioritize or complete?\\n\\n2. **For the personal statement and scholarship essay**: Do you have current drafts you'd like me to review and polish? If so, please share them.\\n\\n3. **For the scholarship essay**: What scholarship are you applying for? Knowing the specific requirements and criteria would help me provide targeted feedback.\\n\\n4. **For any essays I'm writing from scratch**: Are there specific requirements like word count, format, or particular aspects you'd like emphasized?\\n\\n5. **Timeline**: Do you have any deadlines I should be aware of?\\n\\nI can work on multiple tasks, but understanding your priorities will help me deliver the most valuable assistance first.</parameter>\\n</invoke>\", \"function_name\": \"ask\", \"raw_parameters\": {\"text\": \"I'd be happy to help with these essay tasks! To provide the most effective assistance, could you please clarify:\\n\\n1. **Which specific task(s)** would you like me to prioritize or complete?\\n\\n2. **For the personal statement and scholarship essay**: Do you have current drafts you'd like me to review and polish? If so, please share them.\\n\\n3. **For the scholarship essay**: What scholarship are you applying for? Knowing the specific requirements and criteria would help me provide targeted feedback.\\n\\n4. **For any essays I'm writing from scratch**: Are there specific requirements like word count, format, or particular aspects you'd like emphasized?\\n\\n5. **Timeline**: Do you have any deadlines I should be aware of?\\n\\nI can work on multiple tasks, but understanding your priorities will help me deliver the most valuable assistance first.\"}}, \"assistant_message_id\": \"0b0fe51e-97f6-4271-a4f7-65c2211070d3\"}", "created_at": "2025-07-23T08:23:51.869475+00:00", "updated_at": "2025-07-23T08:23:51.869475+00:00", "agent_id": null, "agent_version_id": null}

// 由于本次执行了ask工具, agent执行终止, 等待用户输入
data: {"message_id": "7ed2da91-cf04-4ac5-aa18-6284f84b7a91", "thread_id": "b4c138cc-2851-4775-b732-17626fbace75", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"agent_terminated\"}", "metadata": "{\"thread_run_id\": \"31bc624e-ecc1-4171-8242-6184a785fdf7\"}", "created_at": "2025-07-23T08:23:51.980868+00:00", "updated_at": "2025-07-23T08:23:51.980868+00:00", "agent_id": null, "agent_version_id": null}

// agent本轮执行结束
data: {"type": "status", "status": "completed", "message": "Agent run completed successfully"}
```



在这个流程中, 前端可以在很早的时间点就监听到response中存在tool call, 因此页面上的渲染可以立马开始:

![](tool_call_render.png)



而右侧的Suna' Computer渲染, 可以从返回的tool message中获得完整的所需数据:

![](suna_computer_render.png)



#### 用户第二次输入

```Plain
I have no specific requirements or drafts. You can mock them by yourself.
```

#### Agent第二次执行

```JSON
// thread启动
data: {"message_id": "a135b7bd-c146-49aa-a00e-405737120f70", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_start\", \"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:53:41.374348+00:00", "updated_at": "2025-07-23T09:53:41.374348+00:00", "agent_id": null, "agent_version_id": null}

// 响应开始
data: {"message_id": "edffe85b-34cd-482f-9168-bddd31a8ed5f", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"assistant_response_start\"}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:53:41.505711+00:00", "updated_at": "2025-07-23T09:53:41.505711+00:00", "agent_id": null, "agent_version_id": null}

// 本轮第1个chunk
data: {"sequence": 0, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"##\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:53:41.360316+00:00", "updated_at": "2025-07-23T09:53:41.360316+00:00"}

......

// 本轮最后1个chunk
data: {"sequence": 569, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \">\\n\\n\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:54:23.834811+00:00", "updated_at": "2025-07-23T09:54:23.834811+00:00"}

// full-file-rewrite工具启动的消息
data: {"message_id": "0bc69c0b-cafd-4463-8eb2-e41ea42ba4ca", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Starting execution of full-file-rewrite\", \"tool_index\": 0, \"status_type\": \"tool_started\", \"tool_call_id\": null, \"xml_tag_name\": \"full-file-rewrite\", \"function_name\": \"full_file_rewrite\"}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:54:24.335122+00:00", "updated_at": "2025-07-23T09:54:24.335122+00:00", "agent_id": null, "agent_version_id": null}

// xml tool次数撞到本轮上限: 默认为1. 标记response结束
data: {"message_id": "d8bfd29b-fc90-4bc2-9e39-c80462e7019e", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"xml_tool_limit_reached\"}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:54:28.023138+00:00", "updated_at": "2025-07-23T09:54:28.023138+00:00", "agent_id": null, "agent_version_id": null}

// 完整的llm响应
data: {"message_id": "2f2b7dc1-7b93-4a0d-a339-85bfb3154316", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"## Updated Plan: Proceeding with Mock Drafts and No Specific Requirements\\n\\nThank you for clarifying! Since you have no specific requirements or drafts, I will create all content from scratch, using standard expectations for each type of writing. Here\\u2019s how I\\u2019ll proceed:\\n\\n---\\n\\n### 1. Climate Change Essay  \\nI\\u2019ll write a detailed, engaging essay on climate change, suitable for a general academic audience, approximately 1,000\\u20131,200 words, covering causes, effects, and solutions.\\n\\n### 2. Common App Personal Statement  \\nI\\u2019ll create a mock personal statement draft, then review and polish it as if it were a real student\\u2019s submission.\\n\\n### 3. Scholarship Application Essay  \\nI\\u2019ll generate a plausible scholarship essay draft, review it, and refine it for clarity and persuasiveness.\\n\\n### 4. Literary Analysis Ideas: Of Mice and Men  \\nI\\u2019ll research and generate several compelling literary analysis topics, each with a brief outline or thesis idea.\\n\\n---\\n\\n## Next Steps\\n\\nI\\u2019ll begin by writing the climate change essay, then move through each task in order, updating the todo.md file and providing narrative updates as I go.\\n\\n---\\n\\n### Updating the Plan in todo.md\\n\\nI\\u2019ll mark the requirements/draft clarification steps as complete and proceed to the writing phase.\\n\\n<function_calls>\\n<invoke name=\\\"full_file_rewrite\\\">\\n<parameter name=\\\"file_path\\\">todo.md</parameter>\\n<parameter name=\\\"file_contents\\\">\\n# Multi-Part Writing & Review Task Plan\\n\\n## 1. Climate Change Essay\\n- [x] Clarify essay requirements (using standard academic expectations)\\n- [ ] Research and outline key points\\n- [ ] Write a detailed, engaging essay on climate change\\n- [ ] Review and refine the essay for clarity and impact\\n\\n## 2. Common App Personal Statement\\n- [x] Obtain your draft personal statement (mock draft will be created)\\n- [ ] Review for structure, voice, and impact\\n- [ ] Suggest and implement improvements\\n- [ ] Polish for grammar, style, and conciseness\\n\\n## 3. Scholarship Application Essay\\n- [x] Obtain your draft scholarship essay (mock draft will be created)\\n- [ ] Review for prompt alignment, clarity, and persuasiveness\\n- [ ] Suggest and implement improvements\\n- [ ] Polish for grammar, style, and conciseness\\n\\n## 4. Literary Analysis Ideas: Of Mice and Men\\n- [ ] Research major themes and motifs in the novel\\n- [ ] Generate a list of compelling literary analysis topics\\n- [ ] Provide brief outlines or thesis ideas for each topic\\n\\n## 5. Final Review & Delivery\\n- [ ] Compile all deliverables\\n- [ ] Share results and request your feedback or further instructions\\n</parameter>\\n</invoke>\\n</function_calls>\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T09:54:28.170643+00:00", "updated_at": "2025-07-23T09:54:28.170643+00:00", "agent_id": null, "agent_version_id": null}

// toll call 完成
data: {"message_id": "d4bb9038-d79a-4de1-907a-66d44911e352", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Tool full-file-rewrite completed successfully\", \"tool_index\": 0, \"status_type\": \"tool_completed\", \"tool_call_id\": null, \"xml_tag_name\": \"full-file-rewrite\", \"function_name\": \"full_file_rewrite\"}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\", \"linked_tool_result_message_id\": \"c1f7b717-cebd-4c4d-9ba0-a61222d8e4b3\"}", "created_at": "2025-07-23T09:54:28.477533+00:00", "updated_at": "2025-07-23T09:54:28.477533+00:00", "agent_id": null, "agent_version_id": null}

// 完整的tool message
data: {"message_id": "c1f7b717-cebd-4c4d-9ba0-a61222d8e4b3", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "tool", "is_llm_message": true, "content": "{\"role\": \"user\", \"content\": \"{\\\"tool_execution\\\": {\\\"function_name\\\": \\\"full_file_rewrite\\\", \\\"xml_tag_name\\\": \\\"full-file-rewrite\\\", \\\"tool_call_id\\\": null, \\\"arguments\\\": {\\\"file_path\\\": \\\"todo.md\\\", \\\"file_contents\\\": \\\"# Multi-Part Writing & Review Task Plan\\\\n\\\\n## 1. Climate Change Essay\\\\n- [x] Clarify essay requirements (using standard academic expectations)\\\\n- [ ] Research and outline key points\\\\n- [ ] Write a detailed, engaging essay on climate change\\\\n- [ ] Review and refine the essay for clarity and impact\\\\n\\\\n## 2. Common App Personal Statement\\\\n- [x] Obtain your draft personal statement (mock draft will be created)\\\\n- [ ] Review for structure, voice, and impact\\\\n- [ ] Suggest and implement improvements\\\\n- [ ] Polish for grammar, style, and conciseness\\\\n\\\\n## 3. Scholarship Application Essay\\\\n- [x] Obtain your draft scholarship essay (mock draft will be created)\\\\n- [ ] Review for prompt alignment, clarity, and persuasiveness\\\\n- [ ] Suggest and implement improvements\\\\n- [ ] Polish for grammar, style, and conciseness\\\\n\\\\n## 4. Literary Analysis Ideas: Of Mice and Men\\\\n- [ ] Research major themes and motifs in the novel\\\\n- [ ] Generate a list of compelling literary analysis topics\\\\n- [ ] Provide brief outlines or thesis ideas for each topic\\\\n\\\\n## 5. Final Review & Delivery\\\\n- [ ] Compile all deliverables\\\\n- [ ] Share results and request your feedback or further instructions\\\"}, \\\"result\\\": {\\\"success\\\": true, \\\"output\\\": \\\"File 'todo.md' completely rewritten successfully.\\\", \\\"error\\\": null}}}\"}", "metadata": "{\"parsing_details\": {\"format\": \"v2\", \"raw_xml\": \"<invoke name=\\\"full_file_rewrite\\\">\\n<parameter name=\\\"file_path\\\">todo.md</parameter>\\n<parameter name=\\\"file_contents\\\">\\n# Multi-Part Writing & Review Task Plan\\n\\n## 1. Climate Change Essay\\n- [x] Clarify essay requirements (using standard academic expectations)\\n- [ ] Research and outline key points\\n- [ ] Write a detailed, engaging essay on climate change\\n- [ ] Review and refine the essay for clarity and impact\\n\\n## 2. Common App Personal Statement\\n- [x] Obtain your draft personal statement (mock draft will be created)\\n- [ ] Review for structure, voice, and impact\\n- [ ] Suggest and implement improvements\\n- [ ] Polish for grammar, style, and conciseness\\n\\n## 3. Scholarship Application Essay\\n- [x] Obtain your draft scholarship essay (mock draft will be created)\\n- [ ] Review for prompt alignment, clarity, and persuasiveness\\n- [ ] Suggest and implement improvements\\n- [ ] Polish for grammar, style, and conciseness\\n\\n## 4. Literary Analysis Ideas: Of Mice and Men\\n- [ ] Research major themes and motifs in the novel\\n- [ ] Generate a list of compelling literary analysis topics\\n- [ ] Provide brief outlines or thesis ideas for each topic\\n\\n## 5. Final Review & Delivery\\n- [ ] Compile all deliverables\\n- [ ] Share results and request your feedback or further instructions\\n</parameter>\\n</invoke>\", \"function_name\": \"full_file_rewrite\", \"raw_parameters\": {\"file_path\": \"todo.md\", \"file_contents\": \"# Multi-Part Writing & Review Task Plan\\n\\n## 1. Climate Change Essay\\n- [x] Clarify essay requirements (using standard academic expectations)\\n- [ ] Research and outline key points\\n- [ ] Write a detailed, engaging essay on climate change\\n- [ ] Review and refine the essay for clarity and impact\\n\\n## 2. Common App Personal Statement\\n- [x] Obtain your draft personal statement (mock draft will be created)\\n- [ ] Review for structure, voice, and impact\\n- [ ] Suggest and implement improvements\\n- [ ] Polish for grammar, style, and conciseness\\n\\n## 3. Scholarship Application Essay\\n- [x] Obtain your draft scholarship essay (mock draft will be created)\\n- [ ] Review for prompt alignment, clarity, and persuasiveness\\n- [ ] Suggest and implement improvements\\n- [ ] Polish for grammar, style, and conciseness\\n\\n## 4. Literary Analysis Ideas: Of Mice and Men\\n- [ ] Research major themes and motifs in the novel\\n- [ ] Generate a list of compelling literary analysis topics\\n- [ ] Provide brief outlines or thesis ideas for each topic\\n\\n## 5. Final Review & Delivery\\n- [ ] Compile all deliverables\\n- [ ] Share results and request your feedback or further instructions\"}}, \"assistant_message_id\": \"2f2b7dc1-7b93-4a0d-a339-85bfb3154316\"}", "created_at": "2025-07-23T09:54:28.339585+00:00", "updated_at": "2025-07-23T09:54:28.339585+00:00", "agent_id": null, "agent_version_id": null}

// thread结束
data: {"message_id": "743cdae4-8b34-4af0-9126-db4414f93a33", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_end\"}", "metadata": "{\"thread_run_id\": \"6e645d4d-a11f-48c5-817b-c22939a2739c\"}", "created_at": "2025-07-23T09:54:28.797876+00:00", "updated_at": "2025-07-23T09:54:28.797876+00:00", "agent_id": null, "agent_version_id": null}

// thread开始
data: {"message_id": "362fe6c6-b1d7-4bb5-9e87-3a659831f457", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_start\", \"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:30.288326+00:00", "updated_at": "2025-07-23T09:54:30.288326+00:00", "agent_id": null, "agent_version_id": null}

// response开始
data: {"message_id": "ba2e9fd1-1a5f-42fb-b02a-7669b30f89f6", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"assistant_response_start\"}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:30.421596+00:00", "updated_at": "2025-07-23T09:54:30.421596+00:00", "agent_id": null, "agent_version_id": null}

// 本轮第1个chunk
data: {"sequence": 0, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"##\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:30.332132+00:00", "updated_at": "2025-07-23T09:54:30.332132+00:00"}

......

// 本轮最后1个chunk
data: {"sequence": 189, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \">\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:37.805569+00:00", "updated_at": "2025-07-23T09:54:37.805569+00:00"}

// 开始执行web-search
data: {"message_id": "1e37260a-7c5e-4cc6-97de-b1f5b8ebccc1", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Starting execution of web-search\", \"tool_index\": 0, \"status_type\": \"tool_started\", \"tool_call_id\": null, \"xml_tag_name\": \"web-search\", \"function_name\": \"web_search\"}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:38.266178+00:00", "updated_at": "2025-07-23T09:54:38.266178+00:00", "agent_id": null, "agent_version_id": null}

// response结束
data: {"message_id": "04f95a26-941b-4b8f-b60b-8475e09f8ec2", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"xml_tool_limit_reached\"}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:54.962175+00:00", "updated_at": "2025-07-23T09:54:54.962175+00:00", "agent_id": null, "agent_version_id": null}

// 完整的llm响应
data: {"message_id": "b610ba26-c533-4d6d-9cd2-b59fcfac1d6f", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"## Progress Update: Ready to Begin Writing\\n\\nThe project plan in `todo.md` is now updated to reflect that I\\u2019ll be creating all drafts and content from scratch, using standard academic expectations. The next step is to research and outline the key points for the climate change essay.\\n\\n---\\n\\n### Next Step: Research and Outline for Climate Change Essay\\n\\nI will now:\\n- Research the latest information and perspectives on climate change\\n- Create a detailed outline covering causes, effects, and solutions\\n- Ensure the outline is suitable for a 1,000\\u20131,200 word academic essay\\n\\nOnce the outline is ready, I\\u2019ll proceed to write the full essay.\\n\\n---\\n\\nLet\\u2019s begin with the research and outlining phase.\\n\\n<function_calls>\\n<invoke name=\\\"web_search\\\">\\n<parameter name=\\\"query\\\">climate change causes effects solutions 2025</parameter>\\n<parameter name=\\\"num_results\\\">20</parameter>\\n</invoke>\\n</function_calls>\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T09:54:55.147132+00:00", "updated_at": "2025-07-23T09:54:55.147132+00:00", "agent_id": null, "agent_version_id": null}

// web-search完成
data: {"message_id": "bbf1beb0-259f-45fa-9f72-5dbc8c089746", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Tool web-search completed successfully\", \"tool_index\": 0, \"status_type\": \"tool_completed\", \"tool_call_id\": null, \"xml_tag_name\": \"web-search\", \"function_name\": \"web_search\"}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\", \"linked_tool_result_message_id\": \"43222059-71ff-4c46-8a2f-b8ecce9f20fc\"}", "created_at": "2025-07-23T09:54:55.440368+00:00", "updated_at": "2025-07-23T09:54:55.440368+00:00", "agent_id": null, "agent_version_id": null}

// 完整的tool message
data: {"message_id": "43222059-71ff-4c46-8a2f-b8ecce9f20fc", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "tool", "is_llm_message": true, "content": "{\"role\": \"user\", \"content\": \"{\\\"tool_execution\\\": {\\\"function_name\\\": \\\"web_search\\\", \\\"xml_tag_name\\\": \\\"web-search\\\", \\\"tool_call_id\\\": null, \\\"arguments\\\": {\\\"query\\\": \\\"climate change causes effects solutions 2025\\\", \\\"num_results\\\": 20}, \\\"result\\\": {\\\"success\\\": true, \\\"output\\\": {\\\"query\\\": \\\"climate change causes effects solutions 2025\\\", \\\"follow_up_questions\\\": null, \\\"answer\\\": \\\"Climate change in 2025 continues to accelerate with record-breaking temperatures, as January 2025 became the warmest on record globally despite La Ni\\\\u00f1a conditions, and there's an 80% chance that at least one year between 2025-2029 will be warmer than 2024. The primary causes remain greenhouse gas emissions from burning fossil fuels, which have pushed atmospheric CO2 levels to 422.5 parts per million, with concentrations now higher than any time in the last 800,000 years. The effects are intensifying rapidly, including extreme heat waves that are at least 2\\\\u00b0C hotter and ten times more likely due to climate change, accelerated glacier retreat with the largest three-year loss of glacier mass on record from 2022-2024, rising sea levels, and devastating floods that caused the highest number of climate displacements since 2008. Solutions being implemented include record deployment of clean technologies like solar and geothermal energy, carbon capture technologies, natural climate solutions through forest management, and international cooperation through updated Nationally Determined Contributions ahead of COP30, though there's a 70% chance the five-year average warming for 2025-2029 will exceed 1.5\\\\u00b0C above pre-industrial levels. Digital technologies could potentially reduce global carbon emissions by 17%, while marginalized communities and women remain disproportionately affected by climate impacts, highlighting the need for inclusive climate action that addresses existing inequalities.\\\", \\\"images\\\": [\\\"https://assets.terrapass.com/wp-content/uploads/2019/10/Terrapass-Blog-Climate-Change-Infographic-1200.png\\\", \\\"https://as1.ftcdn.net/v2/jpg/05/05/42/86/1000_F_505428681_N8aSPNW5FIaFzLdWGaqjePDSZFdJM1ES.jpg\\\", \\\"https://www.lshtm.ac.uk/sites/default/files/Climate-change-solutions.jpg\\\", \\\"https://www.metoffice.gov.uk/binaries/content/gallery/metofficegovuk/images/weather/learn-about/climate/global-infographic-resized.jpg/global-infographic-resized.jpg/metofficegovuk:md\\\", \\\"https://www.globalgiving.org/learn/wp-content/uploads/2020/10/Causes-and-Effects-Climate-Change-Chart.png\\\"], \\\"results\\\": [{\\\"url\\\": \\\"https://www.eesi.org/newsletters/view/climate-change-solutions-june-3-2025\\\", \\\"title\\\": \\\"Climate Change Solutions - June 3, 2025 | Newsletter | EESI\\\", \\\"content\\\": \\\"| Hello and welcome to Climate Change Solutions!  In today\\\\u2019s issue, we\\\\u2019re highlighting geothermal and solar energy wins from around the country, and proposals in Congress for tackling carbon emissions globally through a U.S. carbon border adjustment mechanism.  The House and Senate returned from recess this week, and senators are rolling up their sleeves to tackle the budget reconciliation bill. The bill, which passed the House two weeks ago, has far-reaching implications for climate solutions, [...] | |  | | --- | | Hello and welcome to Climate Change Solutions!  In today\\\\u2019s issue, we\\\\u2019re highlighting geothermal and solar energy wins from around the country, and proposals in Congress for tackling carbon emissions globally through a U.S. carbon border adjustment mechanism.  The House and Senate returned from recess this week, and senators are rolling up their sleeves to tackle the budget reconciliation bill. The bill, which passed the House two weeks ago, has far-reaching implications for [...] | |  |  |  |  | | --- | --- | --- | --- | | |  |  |  | | --- | --- | --- | | |  |  | | --- | --- | | |  | | --- | | Hello and welcome to Climate Change Solutions!  In today\\\\u2019s issue, we\\\\u2019re highlighting geothermal and solar energy wins from around the country, and proposals in Congress for tackling carbon emissions globally through a U.S. carbon border adjustment mechanism.  The House and Senate returned from recess this week, and senators are rolling up their sleeves to tackle the budget\\\", \\\"score\\\": 0.8033131, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.americanprogress.org/article/project-2025-would-jeopardize-global-climate-action/\\\", \\\"title\\\": \\\"Project 2025 Would Jeopardize Global Climate Action\\\", \\\"content\\\": \\\"By advocating for a \\\\u201cwhole-of-government unwinding\\\\u201d of U.S. climate policy, Project 2025 puts forward a vision that threatens global efforts to counter climate change effectively. Coupled with efforts to strip government civil service employees of labor protections so that they can more easily be replaced with political loyalists, Project 2025\\\\u2019s policy agenda would trade the federal government\\\\u2019s vast institutional knowledge and forward momentum on climate solutions for dangerous climate [...] Moreover, Project 2025\\\\u2019s plan to replace career civil servants in favor of politically aligned appointees would eliminate the deep wealth of institutional knowledge, subject matter expertise, and relationships the United States relies on to advance climate change solutions internationally. For example, the position of special presidential envoy for climate was created to lead diplomatic initiatives to address climate change. Yet as indicated by Project 2025\\\\u2019s call to reverse climate policies [...] Project 2025 threatens collective, global action on climate change by advocating for the United States to step away from formal engagement in international forums where countries of the world collaborate on shared solutions to the hardest questions facing humanity. These multilateral institutions\\\\u2014which include development banks like the World Bank and intergovernmental organizations like the United Nations\\\\u2014are the main venue for nearly all nations of the world to collectively take on global\\\", \\\"score\\\": 0.66308063, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://charitydigital.org.uk/topics/climate-change-facts-you-need-to-know-in-2025-10655\\\", \\\"title\\\": \\\"Climate change facts you need to know in 2025 - Charity Digital\\\", \\\"content\\\": \\\"But digital also provides solutions. On an organisational and personal level, Blockchain technology could allow concerned citizens to track corporate carbon emissions and digital technology could help reduce the world\\\\u2019s carbon emissions by about 17%, according to a report. [...] The Generation Equality Action Coalition on Feminist Action for Climate Justice found that just 3% of philanthropic environmental funding supports girls\\\\u2019 and women\\\\u2019s environmental activism.\\\\n\\\\nAccording to UN Women, extreme heat increases incidence of stillbirth and the effects of climate change increase the spread of vector-borne illnesses such as malaria, dengue fever, and Zika virus, which are all linked to life-threatening maternal and neonatal outcomes. [...] Marginalised communities disproportionately face the impacts of climate change, such as health consequences, loss of electricity and heat and other amenities, and financial problems, according to Global Citizen. Climate change tends to interact with and worsen existing inequalities that already exist in our society, which highlights the need for an interactional approach to climate action.\\\", \\\"score\\\": 0.64344186, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://yaleclimateconnections.org/2025/01/climate-news-to-watch-in-2025/\\\", \\\"title\\\": \\\"Climate news to watch in 2025\\\", \\\"content\\\": \\\"Republican policymakers also tend to be open to carbon capture solutions. Those include collecting carbon pollution from smokestacks before it enters the atmosphere or removing it from the atmosphere through either technological or natural means. America\\\\u2019s aging forests are starting to remove less carbon from the atmosphere each year. Forestry or other natural climate solutions, which could be included in the 2025 Farm Bill, thus offer some potential for bipartisan climate progress. [...] Much like 2023, many climate and energy records were broken in 2024.\\\\n\\\\nIt was Earth\\\\u2019s hottest year on record by a wide margin, breaking the previous record that was set just last year by an even larger margin. Human-caused climate-warming pollution and atmospheric greenhouse gas concentrations reached new heights. But the record deployment of clean technology solutions in 2024 prevented emissions from rising even higher yet. [...] And while climate pollution caused by burning fossil fuels reached record levels, surpassing 37 billion metric tons while pushing atmospheric carbon dioxide levels to a new height of 422.5 parts per million, those emissions increased by less than 1% compared to the previous year. That\\\\u2019s due to a record deployment of clean technologies around the world.\\\", \\\"score\\\": 0.6364215, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://en.wikipedia.org/wiki/2025_in_climate_change\\\", \\\"title\\\": \\\"2025 in climate change - Wikipedia\\\", \\\"content\\\": \\\"10 March: a study published in _Nature Sustainability_ projected that climate change's cooling of the atmosphere that is occupied by space debris in low Earth orbit will reduce the atmosphere's drag on the debris, extending the debris' lifetime and potentially causing a 50\\\\u201366% reduction in satellite carrying capacity at altitudes 200\\\\u20131,000 km (120\\\\u2013620 mi).( [...] 10 March: a study published in _Nature Sustainability_ projected that climate change's cooling of the atmosphere occupied by space debris in low Earth orbit will reduce the atmosphere's drag on the debris, extending the debris' lifetime and potentially causing a 50\\\\u201366% reduction in satellite carrying capacity at altitudes 200\\\\u20131,000 km (120\\\\u2013620 mi).( [...] 7 March: a study by World Weather Attribution concluded that in a February 2025 heat wave, climate change made extreme heat at least 2\\\\u00b0C hotter and at least ten times more likely.(\\\\n   21 March: on the first World Glaciers Day (established by the UN General Assembly), the World Meteorological Organization reported that five of the past six years witnessed the most rapid glacier retreat on record, and 2022-2024 witnessed the largest three-year loss of glacier mass on record.(\\\", \\\"score\\\": 0.60133666, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.climatecentral.org/report/climate-change-and-the-escalation-of-global-extreme-heat-2025\\\", \\\"title\\\": \\\"Climate Change and the Escalation of Global Extreme Heat\\\", \\\"content\\\": \\\"_Download the data:_for 247 countries over May 1, 2024, to May 1, 2025, and 67 extreme heat events_\\\\n\\\\nAhead of Heat Action Day, this new report from scientists at World Weather Attribution, the Red Cross Red Crescent Climate Centre, and Climate Central assesses the influence of human-caused climate change on dangerous heat waves over the past 12 months (May 1, 2024, to May 1, 2025). [...] _Major funding provided by the Bezos Earth Fund_\\\\n\\\\n### Custom email signup\\\\n\\\\nGet updates, media alerts, and climate reporting resources\\\\n\\\\nSign up\\\\n\\\\n### Support our work\\\\n\\\\nThere are lots of ways to help fund Climate Central today\\\\n\\\\nLearn more\\\\n\\\\nImage 2: Climate Central\\\\n\\\\n   Contact Us\\\\n   Careers\\\\n\\\\n   Donate\\\\n\\\\n   Financials\\\\n   Funders\\\\n\\\\n   Instagram\\\\n   Facebook\\\\n   X\\\\n   YouTube\\\\n\\\\nCopyright \\\\u00a9 2025 Climate Central\\\\n\\\\nRegistered 501(c)(3). EIN: 26-1797336 [...] The period of analysis spans Earth\\\\u2019s hottest year and hottest January ever recorded. The report found that human-caused climate change is boosting dangerous extreme heat for billions of people, and making heat events longer and more likely.\\\\n\\\\nKey findings from the report include:\\\", \\\"score\\\": 0.56200886, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://unfccc.int/news/springboard-for-solutions-highlights-from-the-first-climate-week-of-2025\\\", \\\"title\\\": \\\"Highlights from the First Climate Week of 2025 - UNFCCC\\\", \\\"content\\\": \\\"\\\\\\\"A dominant theme emerging through the week was the urgent need for innovative solutions to unlock climate finance, and drive real-world results\\\", \\\"score\\\": 0.54913354, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.germanwatch.org/en/cri\\\", \\\"title\\\": \\\"Climate Risk Index 2025 - Germanwatch e.V.\\\", \\\"content\\\": \\\"### CRI 2025 ranking and results highlights\\\\n\\\\n_Scorching heat, heavy rainfalls, raging wildfires, deadly floods, and devastating storms: The manifestations of extreme weather events have become too common in a new reality worldwide. The Climate Risk Index 2025 relaunch sheds light on inaction\\\\u2019s growing cost. It reveals the mounting human and economic toll._ [...] 8.   Human-induced climate change affects the frequency and intensity of extreme weather events and leads to widespread adverse climate impacts. The latest climate science and significantly improved attribution science suggest climate change\\\\u2019s influence on extreme weather events is \\\\u2018on the same level of scientific confidence as the statement that human influence has warmed the climate.2 [...] Image 3: Eine Kuhherde in einer D\\\\u00fcrrenlandschaft\\\\n\\\\nClimate Risk Index 2025\\\\n=======================\\\\n\\\\nThe Climate Risk Index (CRI) ranks countries by the human and economic toll of extreme weather. The latest edition highlights increasing losses and the urgent need for stronger climate resilience and action.\\\", \\\"score\\\": 0.54855317, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.un.org/en/climatechange\\\", \\\"title\\\": \\\"ClimateChange | United Nations\\\", \\\"content\\\": \\\"The High-level Political Forum on Sustainable Development (HLPF) is the central UN platform for the follow-up and review of the 2030 Agenda for Sustainable Development and theSDGs. HLPF 2025 will convene under the theme \\\\u201cAdvancing sustainable, inclusive, science- and evidence-based solutions for the 2030 Agenda for Sustainable Development and its Sustainable Development Goals for leaving no one behind\\\\u201d and will review Goal 14 on Life Below Water, along with Goals 3, 5, 8, and 17. [...] 12 Jul 2025\\\\n\\\\nGlobal\\\\n\\\\nImage 19 [...] > ### We cannot, must not, and will not let up on climate action.\\\\\\\"\\\\n> \\\\n> \\\\n> \\\\n> _ANT\\\\u00d3NIO GUTERRES, United Nations Secretary-General (23 April 2025)_\\\\n\\\\nImage 7: Secretary-General Portrait\\\\n\\\\nWatch, Listen and Share\\\\n-----------------------\\\\n\\\\n### As storms intensify, Mozambique bets on mangroves for climate protection\\\", \\\"score\\\": 0.53123426, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://community.youth4climate.info/dashboard/call-solutions-2025\\\", \\\"title\\\": \\\"Call for Solutions 2025 | Youth4Climate\\\", \\\"content\\\": \\\"In 2025, the Youth4Climate Call for Solutions launches its third round of funding opportunities for young people aged 18 to 29 and youth-led entities.\\\", \\\"score\\\": 0.52232456, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.bbc.com/future/article/20241231-seven-proven-ways-to-help-the-planet\\\", \\\"title\\\": \\\"Seven proven ways to help the planet in 2025 - BBC\\\", \\\"content\\\": \\\"Image 13Image 14: Snow on street What snow can teach us about street design ------------------------------------------ Snowfall is helping urban planners design safer and more pleasant streets in the US. 13 Mar 2025 Climate solutions [...] Image 43Image 44: Vertical farm Iceland's high-tech farm turning algae into food ------------------------------------------------ A facility near the Icelandic capital, Reykjavik, is using innovative farming technology to grow algae. 20 Sep 2024 Climate solutions [...] In 2024, the critical 1.5C threshold was breached for a full year for the first time, highlighting the urgent need to rapidly cut global emissions. Much of the work needed to curb climate change goes beyond the remit of individuals \\\\u2013 from scaling up renewable energy to stopping the production of oil, gas and coal. But research shows that individual actions can add up too.\\\", \\\"score\\\": 0.4858686, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://climatepromise.undp.org/what-we-do/flagship-initiatives/climate-promise-2025\\\", \\\"title\\\": \\\"Climate Promise 2025\\\", \\\"content\\\": \\\"With climate impacts becoming more widespread and devastating, the window of opportunity to address the climate crisis is quickly closing. As countries embark on the next cycle of their NDCs ahead of COP30, this moment stands as one of the best chances we have as an international community to ensure warming stays under 1.5\\\\u00b0C and to increase resilience to climate impacts around the world. [...] ##### Why Zambia\\\\u2019s resilient energy future lies in diversifying renewables\\\\n\\\\nPowering climate-resilient solutions is key to ensuring access, stability, and an inclusive future.\\\\n\\\\nRead More\\\\n\\\\nImage 11: Photo: UNDP Zambia > Women\\\\u2019s access to sustainable energy is essential to unlock the full potential of renewable solutions. Photo: UNDP Zambia\\\\n\\\\nLatest Publications\\\\n-------------------\\\\n\\\\nSee all\\\\n\\\\nResearch & Reports\\\\n\\\\nMarch 7, 2025\\\\n\\\\n##### NDC Insights Series [...] Image 2: Climate Promise 2025\\\\u202f\\\\n\\\\nPhoto: UNDP Cuba\\\\n\\\\nImage 3: Climate Promise 2025\\\\u202f\\\\n\\\\nBreadcrumb\\\\n----------\\\\n\\\\n1.   Home\\\\n2.   What We Do\\\\n3.   Flagship Initiatives\\\\n4.    Climate Promise 2025 \\\\n\\\\nClimate Promise 2025\\\\n====================\\\\n\\\\nThe Climate Promise 2025 is a UN System-wide effort with an aim to help countries align their national climate pledges (NDCs) with the 1.5\\\\u00b0C goal, strengthen their quality and investability, and accelerate their implementation to drive sustainable development.\\\", \\\"score\\\": 0.47986987, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.epa.gov/climatechange-science/causes-climate-change\\\", \\\"title\\\": \\\"Causes of Climate Change | US EPA\\\", \\\"content\\\": \\\"Contact Us About Climate Change Science to ask a question, provide feedback, or report a problem.\\\\n\\\\nLast updated on March 25, 2025\\\\n\\\\n   Assistance\\\\n   Spanish\\\\n   Arabic\\\\n   Chinese (simplified)\\\\n   Chinese (traditional)\\\\n   French\\\\n   Haitian Creole\\\\n   Korean\\\\n   Portuguese\\\\n   Russian\\\\n   Tagalog\\\\n   Vietnamese\\\\n\\\\nImage 8: United States Environmental Protection Agency\\\\n\\\\nDiscover.\\\\n--------- [...] Concentrations of the key greenhouse gases have all increased since the Industrial Revolution due to human activities. Carbon dioxide, methane, and nitrous oxide concentrations are now more abundant in the earth\\\\u2019s atmosphere than any time in the last 800,000 years.8,9These greenhouse gas emissions have increased the greenhouse effect and caused the earth\\\\u2019s surface temperature to rise. Burning fossil fuels changes the climate more than any other human activity. [...] 27 National Academy of Sciences. (2020). _Climate change: Evidence and causes: Update 2020._ The National Academies Press, Washington, DC, pp. 9\\\\u201310. doi: 10.17226/25733\\\\n\\\\nClimate Change Science\\\\n-------------------------------------------------------------------\\\\n\\\\n   Basics\\\\n   Causes\\\\n   Impacts\\\\n   Future of Climate Change\\\\n       Extreme Heat\\\\n       Extreme Precipitation\\\\n\\\\n   Frequently Asked Questions\\\\n\\\\nContact Us About Climate Change Science\\\\n\\\\nContact Us About Climate Change Science\\\", \\\"score\\\": 0.41279107, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.greenpeace.org.uk/challenges/climate-change/solutions-climate-change/\\\", \\\"title\\\": \\\"What are the solutions to climate change? - Greenpeace UK\\\", \\\"content\\\": \\\"Indigenous Peoples are most severely affected by both the causes and effects of climate change. They are often on the front lines, facing down deforestation or kicking out fossil fuel industries polluting their water supplies.\\\\n\\\\nCommunities in the Pacific Islands are facing sea level rises and more extreme weather. But they are using their strength and resilience to demand world leaders take quicker climate action. [...] Climate change is already an urgent threat to millions of lives \\\\u2013 but there are solutions. From changing how we get our energy to limiting deforestation, here are some of the key solutions to climate change.\\\\n\\\\nClimate change is happening now, and it\\\\u2019s the most serious threat to life on our planet. Luckily, there are plenty of solutions to climate change and they are well-understood.\\\\n\\\\nIn 2015, world leaders signed a major treaty called the Paris agreement to put these solutions into practice. [...] Core to all climate change solutions is reducing greenhouse gas emissions, which must get to zero as soon as possible.\\\\n\\\\nBecause both forests and oceans play vitally important roles in regulating our climate, increasing the natural ability of forests and oceans to absorb carbon dioxide can also help stop global warming.\\\\n\\\\nImage 2: People symbolically raising a Wind Turbine to show the importance of green jobs.\\\\n\\\\nBe the first to know\\\\n--------------------\\\", \\\"score\\\": 0.40056232, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.nytimes.com/2025/06/26/climate/climate-heat-intensity.html\\\", \\\"title\\\": \\\"The World Is Warming Up. And It's Happening Faster.\\\", \\\"content\\\": \\\"Published Time: 2025-06-26T15:50:50.000Z\\\\n\\\\nGlobal Warming Is Speeding Up and the World Is Feeling the Effects - The New York Times\\\\n\\\\n===============\\\\n\\\\nSkip to contentSkip to site indexSearch & Section Navigation Section Navigation\\\\n\\\\nSEARCH\\\\n\\\\nClimate\\\\n\\\\n[](\\\\n\\\\nSubscribe for $1/weekLog in[](\\\\n\\\\nMonday, June 30, 2025\\\\n\\\\nToday\\\\u2019s Paper\\\\n\\\\nSubscribe for $1/week\\\\n\\\\n[](\\\\nExtreme Heat [...] Claire Brown covers climate change for The Times and writes for the Climate Forward newsletter.\\\\n\\\\nMira Rojanasakul is a Times reporter who uses data and graphics to cover climate and the environment.\\\\n\\\\nA version of this article appears in print on June 27, 2025, Section A, Page 5 of the New York edition with the headline: Earth Is Being Cooked at a Quickening Pace. Order Reprints | Today\\\\u2019s Paper | Subscribe\\\\n\\\\n   Share full article \\\\n    \\\\n\\\\nAdvertisement\\\\n\\\\nSKIP ADVERTISEMENT\\\\n\\\\nSite Index\\\\n---------- [...] Monthly temperature\\\\n\\\\n1900\\\\n\\\\n1940\\\\n\\\\n1980\\\\n\\\\n2020\\\\n\\\\nSource: NASA Goddard Institute for Space Studies\\\\n\\\\nNote: Data available through May 2025. Anomalies relative to the average temperature between 1951 and 1980.\\\\n\\\\nThe New York Times\\\\n\\\\nBy Sachi Kitajima MulkeyClaire Brown and Mira Rojanasakul\\\\n\\\\nJune 26, 2025\\\", \\\"score\\\": 0.39117387, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://climate.copernicus.eu/copernicus-january-2025-was-warmest-record-globally-despite-emerging-la-nina\\\", \\\"title\\\": \\\"January 2025 was the warmest on record globally, despite an ...\\\", \\\"content\\\": \\\"According to Samantha Burgess, Strategic Lead for Climate at ECMWF:\\\\n\\\\n\\\\\\\"January 2025 is another surprising month, continuing the record temperatures observed throughout the last two years, despite the development of La Ni\\\\u00f1a conditions in the tropical Pacific and their temporary cooling effect on global temperatures. Copernicus will continue to closely monitor ocean temperatures and their influence on our evolving climate throughout 2025.\\\\u201d [...] Image 3: C3S_PR_202501_Fig2_timeseries_global_temperature_anomalies_ref1850-1900_allmonths\\\\n\\\\nMonthly global surface air temperature anomalies (\\\\u00b0C) relative to 1850\\\\u20131900 from January 1940 to January 2025, plotted as time series for each year. 2025 is shown with a thick red line, 2024 with a thick orange line, 2023 with a thick yellow line, and all other years with thin grey lines. Data source: ERA5. Credit: Copernicus Climate Change Service /ECMWF.\\\\n\\\\nDOWNLOAD IMAGE | DOWNLOAD PDF | DOWNLOAD DATA [...] Copernicus: January 2025 was the warmest on record globally, despite an emerging La Ni\\\\u00f1a | Copernicus\\\\n\\\\n===============\\\\nskip to main content\\\\n\\\\n Implemented by ECMWF as part of The Copernicus Programme\\\\n\\\\nSecondary navigation\\\\n--------------------\\\\n\\\\n   News\\\\n   Events\\\\n   Press\\\\n   Tenders & Grants\\\\n   Help & Support\\\\n\\\\n Search \\\\n\\\\nImage 1\\\\n\\\\nClimate Change Service\\\\n\\\\nMain navigation\\\\n---------------\\\\n\\\\n   About Us\\\\n   What we do\\\\n   Data\\\\n\\\\n   News\\\\n   Events\\\\n   Press\\\\n   Tenders & Grants\\\\n   Help & Support\\\\n\\\\nclose\\\", \\\"score\\\": 0.3570971, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://wmo.int/news/media-centre/global-climate-predictions-show-temperatures-expected-remain-or-near-record-levels-coming-5-years\\\", \\\"title\\\": \\\"Global climate predictions show temperatures expected to remain at ...\\\", \\\"content\\\": \\\"There is a forecast 70% chance that the five-year average warming for 2025-2029 will be more than 1.5\\\\u00b0C, according to the report. This is up from 47% in last year\\\\u2019s report (for the 2024-2028 period) and up from 32% in the 2023 report for the 2023-2027 period.\\\\n\\\\nEvery additional fraction of a degree of warming drives more harmful heatwaves, extreme rainfall events, intense droughts, melting of ice sheets, sea ice, and glaciers, heating of the ocean, and rising sea levels.\\\\n\\\\nOther key points: [...] There is an 80% chance that at least one year between 2025 and 2029 will be warmer than the warmest year on record (currently 2024). And there is an 86% chance that at least one year will be more than 1.5\\\\u00b0C above the pre-industrial level. The report does not give global predictions for individual years. [...] This latest decadal climate forecast predicts that the central estimate of the 20-year average warming for 2015-2034 will be 1.44\\\\u00b0C, (with a 90% confidence range of 1.22\\\\u20131.54\\\\u00b0C). A WMO team of international experts is considering all of these estimates in order to ensure consistent, reliable and timely tracking of long-term global temperature changes.\\\\n\\\\n Global Annual to Decadal Update 2025-2029 - English \\\\n\\\\nNotes to Editors\\\\n----------------\\\", \\\"score\\\": 0.27606478, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://www.ncei.noaa.gov/news/global-climate-202501\\\", \\\"title\\\": \\\"Assessing the Global Climate in January 2025 | News\\\", \\\"content\\\": \\\"Five named storms occurred across the globe in January, which was below the average of seven. Three named storms formed in the southwestern Indian Ocean, the most impactful being Intense Tropical Cyclone Dikeledi, which made landfall on Madagascar and Mozambique, bringing high winds and heavy rains to the affected regions.\\\\n\\\\n  \\\\n\\\\nFor a more complete summary of climate conditions and events, see our January 2025 Global Climate Report or explore our Climate at a Glance Global Time Series. [...] Read More\\\\n\\\\nImage 11: Flock of sheep sheltering from the heat under a fig tree in the summer.\\\\n\\\\nJuly 9, 2025\\\\n\\\\n### Assessing the U.S. Climate in June 2025\\\\n\\\\nRead More\\\\n\\\\nImage 12: Strawberries on top of a mirror in a strawberry field next to a blooming strawberry plant.\\\\n\\\\nJune 30, 2025\\\\n\\\\n### Regional Temperature and Precipitation Impacts and Outlooks\\\\n\\\\nRead More\\\\n\\\\nReturn to top\\\\n\\\\nImage 13: National Centers for Environmental Information\\\\n\\\\nFollow Us\\\\n--------- [...] Image 8: Global map showing land and ocean temperature departure from average for January 2025 with warmer areas colored in gradients of red and cooler areas in gradients of blue.\\\", \\\"score\\\": 0.26431015, \\\"raw_content\\\": null}, {\\\"url\\\": \\\"https://en.news.un.org/en/story/2025/05/1163751\\\", \\\"title\\\": \\\"Climate change: World likely to breach 1.5\\\\u00b0C limit in next five years\\\", \\\"content\\\": \\\"### Climate change: Paris Agreement goals still within reach, says UN chief\\\\n\\\\nThe effects of human-driven climate change surged to alarming levels in 2024, with some consequences likely to be irreversible for centuries - if not millennia \\\\u2013 according to a new report from the World Meteorological Organization (WMO). \\\\n\\\\n## Resources Button collapse\\\\n\\\\n## Secretary-General Button collapse\\\\n\\\\n## Spokesperson's Office Button collapse\\\\n\\\\n## Find Us Button collapse\\\\n\\\\n## Footer menu\\\\n\\\\n## Social Media Links [...] Devastating floods in South Sudan in recent months left thousands of herders without their most precious possessions: goats, cows and cattle. The animals are central to people\\\\u2019s lives and age-old customs including marriage and cultural traditions. All risk being swept away or scorched by the ravages of climate change.\\\\n\\\\nExtreme weather events in 2024 led to the highest number of new displacements recorded in a year since 2008. [...] The situation is even more catastrophic in the Arctic than in the rest of the world. The average Arctic temperature over the next five winters (November to March) is expected to be 2.4\\\\u00b0C warmer than the 1991\\\\u20132020 average, more than three and a half times the increase in the global average temperature.\\\\n\\\\nSea ice is expected to keep shrinking, particularly in the Barents, Bering, and Okhotsk Seas, contributing to rising sea levels and disrupted weather patterns worldwide.\\\", \\\"score\\\": 0.21767862, \\\"raw_content\\\": null}], \\\"response_time\\\": 14.55}, \\\"error\\\": null}}}\"}", "metadata": "{\"parsing_details\": {\"format\": \"v2\", \"raw_xml\": \"<invoke name=\\\"web_search\\\">\\n<parameter name=\\\"query\\\">climate change causes effects solutions 2025</parameter>\\n<parameter name=\\\"num_results\\\">20</parameter>\\n</invoke>\", \"function_name\": \"web_search\", \"raw_parameters\": {\"query\": \"climate change causes effects solutions 2025\", \"num_results\": \"20\"}}, \"assistant_message_id\": \"b610ba26-c533-4d6d-9cd2-b59fcfac1d6f\"}", "created_at": "2025-07-23T09:54:55.303176+00:00", "updated_at": "2025-07-23T09:54:55.303176+00:00", "agent_id": null, "agent_version_id": null}

// thread结束
data: {"message_id": "0dcfdf50-2551-430b-80d8-eb191936500f", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_end\"}", "metadata": "{\"thread_run_id\": \"25368640-4316-4814-9784-e2ef9b746c33\"}", "created_at": "2025-07-23T09:54:55.729129+00:00", "updated_at": "2025-07-23T09:54:55.729129+00:00", "agent_id": null, "agent_version_id": null}

// thread开始
data: {"message_id": "63f2b258-b16f-41a5-bd82-423d74182626", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_start\", \"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "metadata": "{\"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "created_at": "2025-07-23T09:54:58.845647+00:00", "updated_at": "2025-07-23T09:54:58.845647+00:00", "agent_id": null, "agent_version_id": null}

// response开始
data: {"message_id": "46e4416c-0264-4a29-a788-c1f38d68db1f", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"assistant_response_start\"}", "metadata": "{\"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "created_at": "2025-07-23T09:54:58.972193+00:00", "updated_at": "2025-07-23T09:54:58.972193+00:00", "agent_id": null, "agent_version_id": null}

// 本轮第1个chunk
data: {"sequence": 0, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"##\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "created_at": "2025-07-23T09:54:58.880246+00:00", "updated_at": "2025-07-23T09:54:58.880246+00:00"}

......

// 本轮最后1个chunk
data: {"sequence": 702, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \".\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "created_at": "2025-07-23T09:55:16.732319+00:00", "updated_at": "2025-07-23T09:55:16.732319+00:00"}

// 本轮完整的响应
data: {"message_id": "eb0cf999-916b-49b0-9048-ef19fab29e21", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"## Research Complete: Key Points for Climate Change Essay\\n\\nI've gathered the latest information on climate change as of 2025. Here are the most relevant, up-to-date facts and perspectives, which I\\u2019ll use to create a detailed outline for the essay:\\n\\n- 2025 is seeing record-breaking global temperatures, with January 2025 the warmest on record, and an 80% chance that at least one year between 2025\\u20132029 will be warmer than 2024.\\n- The primary cause remains greenhouse gas emissions from burning fossil fuels, pushing atmospheric CO\\u2082 to 422.5 ppm\\u2014higher than any time in the last 800,000 years.\\n- Effects are intensifying: extreme heat waves (at least 2\\u00b0C hotter and ten times more likely), accelerated glacier retreat (largest three-year loss on record from 2022\\u20132024), rising sea levels, and devastating floods causing the highest number of climate displacements since 2008.\\n- Solutions include rapid deployment of clean technologies (solar, geothermal), carbon capture, natural climate solutions (forest management), and international cooperation (updated Nationally Determined Contributions ahead of COP30).\\n- Digital technologies could reduce global carbon emissions by 17%.\\n- Marginalized communities and women are disproportionately affected, highlighting the need for inclusive climate action.\\n\\n---\\n\\n## Climate Change Essay Outline\\n\\n**Title:**  \\nClimate Change in 2025: Causes, Consequences, and the Path Forward\\n\\n**Introduction:**  \\n- Brief overview of the climate crisis in 2025  \\n- The urgency of the issue: record-breaking temperatures and accelerating impacts  \\n- Thesis: Understanding the causes, effects, and solutions is essential for effective action\\n\\n**Body Paragraph 1: Causes of Climate Change**  \\n- Greenhouse gas emissions from fossil fuels as the primary driver  \\n- CO\\u2082 levels at 422.5 ppm, the highest in 800,000 years  \\n- Other contributors: methane, nitrous oxide, deforestation, industrial agriculture  \\n- The role of human activity since the Industrial Revolution\\n\\n**Body Paragraph 2: Effects of Climate Change**  \\n- Extreme heat waves: more frequent, more intense, and longer-lasting  \\n- Accelerated glacier retreat and loss of ice mass  \\n- Rising sea levels and increased flooding  \\n- Displacement of populations: highest climate-related displacement since 2008  \\n- Health impacts: spread of vector-borne diseases, heat-related illnesses  \\n- Disproportionate effects on marginalized communities and women\\n\\n**Body Paragraph 3: Solutions and Hope**  \\n- Rapid deployment of clean energy technologies: solar, geothermal, wind  \\n- Carbon capture and storage innovations  \\n- Natural climate solutions: forest management, reforestation, ocean conservation  \\n- The role of digital technologies in reducing emissions  \\n- International cooperation: COP30, Nationally Determined Contributions  \\n- The importance of inclusive, equitable climate action\\n\\n**Conclusion:**  \\n- The window for action is closing, but solutions are available  \\n- The need for global, inclusive, and immediate action  \\n- Call to action: everyone has a role to play in addressing climate change\\n\\n---\\n\\n### Next Step\\n\\nI will now write the full essay based on this outline, ensuring it is detailed, engaging, and suitable for a general academic audience.\\n\\n---\\n\\n**Progress update:**  \\n- Research and outline for the climate change essay are complete.  \\n- Next, I will write the essay and then review and refine it for clarity and impact.\\n\\nProceeding to draft the essay now.\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T09:55:17.261348+00:00", "updated_at": "2025-07-23T09:55:17.261348+00:00", "agent_id": null, "agent_version_id": null}

// response结束
data: {"message_id": "0a31e16c-9f79-499f-8a9f-a6b50eb38f79", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"stop\"}", "metadata": "{\"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "created_at": "2025-07-23T09:55:17.656553+00:00", "updated_at": "2025-07-23T09:55:17.656553+00:00", "agent_id": null, "agent_version_id": null}

// thread结束
data: {"message_id": "d391e8f6-d425-4096-92d7-d14c5eda12b8", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"thread_run_end\"}", "metadata": "{\"thread_run_id\": \"18ccaf9c-ebd8-4c22-a43f-d1eb48327b5a\"}", "created_at": "2025-07-23T09:55:17.97401+00:00", "updated_at": "2025-07-23T09:55:17.97401+00:00", "agent_id": null, "agent_version_id": null}

// agent结束
data: {"type": "status", "status": "completed", "message": "Agent run completed successfully"}
```

这一次agent执行涉及了web-search, 完整的tool result如下, 包含5个image和19个网站

```JSON
{
    "message_id": "43222059-71ff-4c46-8a2f-b8ecce9f20fc",
    "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a",
    "type": "tool",
    "is_llm_message": true,
    "content": {
        "role": "user",
        "content": {
            "tool_execution": {
                "function_name": "web_search",
                "xml_tag_name": "web-search",
                "tool_call_id": null,
                "arguments": {
                    "query": "climate change causes effects solutions 2025",
                    "num_results": 20
                },
                "result": {
                    "success": true,
                    "output": {
                        "query": "climate change causes effects solutions 2025",
                        "follow_up_questions": null,
                        "answer": "Climate change in 2025 continues to accelerate with record-breaking temperatures, as January 2025 became the warmest on record globally despite La Niña conditions, and there's an 80% chance that at least one year between 2025–2029 will be warmer than 2024. The primary causes remain greenhouse gas emissions from burning fossil fuels, which have pushed atmospheric CO2 levels to 422.5 parts per million, with concentrations now higher than any time in the last 800,000 years. The effects are intensifying rapidly, including extreme heat waves that are at least 2°C hotter and ten times more likely due to climate change, accelerated glacier retreat with the largest three-year loss of glacier mass on record from 2022-2024, rising sea levels, and devastating floods that caused the highest number of climate displacements since 2008. Solutions being implemented include record deployment of clean technologies like solar and geothermal energy, carbon capture technologies, natural climate solutions through forest management, and international cooperation through updated Nationally Determined Contributions ahead of COP30, though there's a 70% chance the five-year average warming for 2025-2029 will exceed 1.5°C above pre-industrial levels. Digital technologies could potentially reduce global carbon emissions by 17%, while marginalized communities and women remain disproportionately affected by climate impacts, highlighting the need for inclusive climate action that addresses existing inequalities.",
                        "images": [
                            "https://assets.terrapass.com/wp-content/uploads/2019/10/Terrapass-Blog-Climate-Change-Infographic-1200.png",
                            "https://as1.ftcdn.net/v2/jpg/05/05/42/86/1000_F_505428681_N8aSPNW5FIaFzLdWGaqjePDSZFdJM1ES.jpg",
                            "https://www.lshtm.ac.uk/sites/default/files/Climate-change-solutions.jpg",
                            "https://www.metoffice.gov.uk/binaries/content/gallery/metofficegovuk/images/weather/learn-about/climate/global-infographic-resized.jpg/global-infographic-resized.jpg/metofficegovuk:md",
                            "https://www.globalgiving.org/learn/wp-content/uploads/2020/10/Causes-and-Effects-Climate-Change-Chart.png"
                        ],
                        "results": [
                            {
                                "url": "https://www.eesi.org/newsletters/view/climate-change-solutions-june-3-2025",
                                "title": "Climate Change Solutions - June 3, 2025 | Newsletter | EESI",
                                "content": "| Hello and welcome to Climate Change Solutions!  In today’s issue, we’re highlighting geothermal and solar energy wins from around the country, and proposals in Congress for tackling carbon emissions globally through a U.S. carbon border adjustment mechanism.  The House and Senate returned from recess this week, and senators are rolling up their sleeves to tackle the budget reconciliation bill. The bill, which passed the House two weeks ago, has far-reaching implications for climate solutions, [...] | |  | | --- | | Hello and welcome to Climate Change Solutions!  In today’s issue, we’re highlighting geothermal and solar energy wins from around the country, and proposals in Congress for tackling carbon emissions globally through a U.S. carbon border adjustment mechanism.  The House and Senate returned from recess this week, and senators are rolling up their sleeves to tackle the budget reconciliation bill. The bill, which passed the House two weeks ago, has far-reaching implications for [...] | |  |  |  |  | | --- | --- | --- | --- | | |  |  |  | | --- | --- | --- | | |  |  | | --- | --- | | |  | | --- | | Hello and welcome to Climate Change Solutions!  In today’s issue, we’re highlighting geothermal and solar energy wins from around the country, and proposals in Congress for tackling carbon emissions globally through a U.S. carbon border adjustment mechanism.  The House and Senate returned from recess this week, and senators are rolling up their sleeves to tackle the budget",
                                "score": 0.8033131,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.americanprogress.org/article/project-2025-would-jeopardize-global-climate-action/",
                                "title": "Project 2025 Would Jeopardize Global Climate Action",
                                "content": "By advocating for a “whole-of-government unwinding” of U.S. climate policy, Project 2025 puts forward a vision that threatens global efforts to counter climate change effectively. Coupled with efforts to strip government civil service employees of labor protections so that they can more easily be replaced with political loyalists, Project 2025’s policy agenda would trade the federal government’s vast institutional knowledge and forward momentum on climate solutions for dangerous climate [...] Moreover, Project 2025’s plan to replace career civil servants in favor of politically aligned appointees would eliminate the deep wealth of institutional knowledge, subject matter expertise, and relationships the United States relies on to advance climate change solutions internationally. For example, the position of special presidential envoy for climate was created to lead diplomatic initiatives to address climate change. Yet as indicated by Project 2025’s call to reverse climate policies [...] Project 2025 threatens collective, global action on climate change by advocating for the United States to step away from formal engagement in international forums where countries of the world collaborate on shared solutions to the hardest questions facing humanity. These multilateral institutions—which include development banks like the World Bank and intergovernmental organizations like the United Nations—are the main venue for nearly all nations of the world to collectively take on global",
                                "score": 0.66308063,
                                "raw_content": null
                            },
                            {
                                "url": "https://charitydigital.org.uk/topics/climate-change-facts-you-need-to-know-in-2025-10655",
                                "title": "Climate change facts you need to know in 2025 - Charity Digital",
                                "content": "But digital also provides solutions. On an organisational and personal level, Blockchain technology could allow concerned citizens to track corporate carbon emissions and digital technology could help reduce the world’s carbon emissions by about 17%, according to a report. [...] The Generation Equality Action Coalition on Feminist Action for Climate Justice found that just 3% of philanthropic environmental funding supports girls’ and women’s environmental activism.\n\nAccording to UN Women, extreme heat increases incidence of stillbirth and the effects of climate change increase the spread of vector-borne illnesses such as malaria, dengue fever, and Zika virus, which are all linked to life-threatening maternal and neonatal outcomes. [...] Marginalised communities disproportionately face the impacts of climate change, such as health consequences, loss of electricity and heat and other amenities, and financial problems, according to Global Citizen. Climate change tends to interact with and worsen existing inequalities that already exist in our society, which highlights the need for an interactional approach to climate action.",
                                "score": 0.64344186,
                                "raw_content": null
                            },
                            {
                                "url": "https://yaleclimateconnections.org/2025/01/climate-news-to-watch-in-2025/",
                                "title": "Climate news to watch in 2025",
                                "content": "Republican policymakers also tend to be open to carbon capture solutions. Those include collecting carbon pollution from smokestacks before it enters the atmosphere or removing it from the atmosphere through either technological or natural means. America’s aging forests are starting to remove less carbon from the atmosphere each year. Forestry or other natural climate solutions, which could be included in the 2025 Farm Bill, thus offer some potential for bipartisan climate progress. [...] Much like 2023, many climate and energy records were broken in 2024.\n\nIt was Earth’s hottest year on record by a wide margin, breaking the previous record that was set just last year by an even larger margin. Human-caused climate-warming pollution and atmospheric greenhouse gas concentrations reached new heights. But the record deployment of clean technology solutions in 2024 prevented emissions from rising even higher yet. [...] And while climate pollution caused by burning fossil fuels reached record levels, surpassing 37 billion metric tons while pushing atmospheric carbon dioxide levels to a new height of 422.5 parts per million, those emissions increased by less than 1% compared to the previous year. That’s due to a record deployment of clean technologies around the world.",
                                "score": 0.6364215,
                                "raw_content": null
                            },
                            {
                                "url": "https://en.wikipedia.org/wiki/2025_in_climate_change",
                                "title": "2025 in climate change - Wikipedia",
                                "content": "10 March: a study published in _Nature Sustainability_ projected that climate change's cooling of the atmosphere that is occupied by space debris in low Earth orbit will reduce the atmosphere's drag on the debris, extending the debris' lifetime and potentially causing a 50–66% reduction in satellite carrying capacity at altitudes 200–1,000 km (120–620 mi).( [...] 10 March: a study published in _Nature Sustainability_ projected that climate change's cooling of the atmosphere occupied by space debris in low Earth orbit will reduce the atmosphere's drag on the debris, extending the debris' lifetime and potentially causing a 50–66% reduction in satellite carrying capacity at altitudes 200–1,000 km (120–620 mi).( [...] 7 March: a study by World Weather Attribution concluded that in a February 2025 heat wave, climate change made extreme heat at least 2°C hotter and at least ten times more likely.(\n   21 March: on the first World Glaciers Day (established by the UN General Assembly), the World Meteorological Organization reported that five of the past six years witnessed the most rapid glacier retreat on record, and 2022-2024 witnessed the largest three-year loss of glacier mass on record.(",
                                "score": 0.60133666,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.climatecentral.org/report/climate-change-and-the-escalation-of-global-extreme-heat-2025",
                                "title": "Climate Change and the Escalation of Global Extreme Heat",
                                "content": "_Download the data:_for 247 countries over May 1, 2024, to May 1, 2025, and 67 extreme heat events_\n\nAhead of Heat Action Day, this new report from scientists at World Weather Attribution, the Red Cross Red Crescent Climate Centre, and Climate Central assesses the influence of human-caused climate change on dangerous heat waves over the past 12 months (May 1, 2024, to May 1, 2025). [...] _Major funding provided by the Bezos Earth Fund_\n\n### Custom email signup\n\nGet updates, media alerts, and climate reporting resources\n\nSign up\n\n### Support our work\n\nThere are lots of ways to help fund Climate Central today\n\nLearn more\n\nImage 2: Climate Central\n\n   Contact Us\n   Careers\n\n   Donate\n\n   Financials\n   Funders\n\n   Instagram\n   Facebook\n   X\n   YouTube\n\nCopyright © 2025 Climate Central\n\nRegistered 501(c)(3). EIN: 26-1797336 [...] The period of analysis spans Earth’s hottest year and hottest January ever recorded. The report found that human-caused climate change is boosting dangerous extreme heat for billions of people, and making heat events longer and more likely.\n\nKey findings from the report include:",
                                "score": 0.56200886,
                                "raw_content": null
                            },
                            {
                                "url": "https://unfccc.int/news/springboard-for-solutions-highlights-from-the-first-climate-week-of-2025",
                                "title": "Highlights from the First Climate Week of 2025 - UNFCCC",
                                "content": "\"A dominant theme emerging through the week was the urgent need for innovative solutions to unlock climate finance, and drive real-world results",
                                "score": 0.54913354,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.germanwatch.org/en/cri",
                                "title": "Climate Risk Index 2025 - Germanwatch e.V.",
                                "content": "### CRI 2025 ranking and results highlights\n\n_Scorching heat, heavy rainfalls, raging wildfires, deadly floods, and devastating storms: The manifestations of extreme weather events have become too common in a new reality worldwide. The Climate Risk Index 2025 relaunch sheds light on inaction’s growing cost. It reveals the mounting human and economic toll._ [...] 8.   Human-induced climate change affects the frequency and intensity of extreme weather events and leads to widespread adverse climate impacts. The latest climate science and significantly improved attribution science suggest climate change’s influence on extreme weather events is ‘on the same level of scientific confidence as the statement that human influence has warmed the climate.2 [...] Image 3: Eine Kuhherde in einer Dürrenlandschaft\n\nClimate Risk Index 2025\n=======================\n\nThe Climate Risk Index (CRI) ranks countries by the human and economic toll of extreme weather. The latest edition highlights increasing losses and the urgent need for stronger climate resilience and action.",
                                "score": 0.54855317,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.un.org/en/climatechange",
                                "title": "ClimateChange | United Nations",
                                "content": "The High-level Political Forum on Sustainable Development (HLPF) is the central UN platform for the follow-up and review of the 2030 Agenda for Sustainable Development and theSDGs. HLPF 2025 will convene under the theme “Advancing sustainable, inclusive, science- and evidence-based solutions for the 2030 Agenda for Sustainable Development and its Sustainable Development Goals for leaving no one behind” and will review Goal 14 on Life Below Water, along with Goals 3, 5, 8, and 17. [...] 12 Jul 2025\n\nGlobal\n\nImage 19 [...] > ### We cannot, must not, and will not let up on climate action.\"\n> \n> \n> \n> _ANTÓNIO GUTERRES, United Nations Secretary-General (23 April 2025)_\n\nImage 7: Secretary-General Portrait\n\nWatch, Listen and Share\n-----------------------\n\n### As storms intensify, Mozambique bets on mangroves for climate protection",
                                "score": 0.53123426,
                                "raw_content": null
                            },
                            {
                                "url": "https://community.youth4climate.info/dashboard/call-solutions-2025",
                                "title": "Call for Solutions 2025 | Youth4Climate",
                                "content": "In 2025, the Youth4Climate Call for Solutions launches its third round of funding opportunities for young people aged 18 to 29 and youth-led entities.",
                                "score": 0.52232456,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.bbc.com/future/article/20241231-seven-proven-ways-to-help-the-planet",
                                "title": "Seven proven ways to help the planet in 2025 - BBC",
                                "content": "Image 13Image 14: Snow on street What snow can teach us about street design ------------------------------------------ Snowfall is helping urban planners design safer and more pleasant streets in the US. 13 Mar 2025 Climate solutions [...] Image 43Image 44: Vertical farm Iceland's high-tech farm turning algae into food ------------------------------------------------ A facility near the Icelandic capital, Reykjavik, is using innovative farming technology to grow algae. 20 Sep 2024 Climate solutions [...] In 2024, the critical 1.5C threshold was breached for a full year for the first time, highlighting the urgent need to rapidly cut global emissions. Much of the work needed to curb climate change goes beyond the remit of individuals – from scaling up renewable energy to stopping the production of oil, gas and coal. But research shows that individual actions can add up too.",
                                "score": 0.4858686,
                                "raw_content": null
                            },
                            {
                                "url": "https://climatepromise.undp.org/what-we-do/flagship-initiatives/climate-promise-2025",
                                "title": "Climate Promise 2025",
                                "content": "With climate impacts becoming more widespread and devastating, the window of opportunity to address the climate crisis is quickly closing. As countries embark on the next cycle of their NDCs ahead of COP30, this moment stands as one of the best chances we have as an international community to ensure warming stays under 1.5°C and to increase resilience to climate impacts around the world. [...] ##### Why Zambia’s resilient energy future lies in diversifying renewables\n\nPowering climate-resilient solutions is key to ensuring access, stability, and an inclusive future.\n\nRead More\n\nImage 11: Photo: UNDP Zambia > Women’s access to sustainable energy is essential to unlock the full potential of renewable solutions. Photo: UNDP Zambia\n\nLatest Publications\n-------------------\n\nSee all\n\nResearch & Reports\n\nMarch 7, 2025\n\n##### NDC Insights Series [...] Image 2: Climate Promise 2025 \n\nPhoto: UNDP Cuba\n\nImage 3: Climate Promise 2025 \n\nBreadcrumb\n----------\n\n1.   Home\n2.   What We Do\n3.   Flagship Initiatives\n4.    Climate Promise 2025 \n\nClimate Promise 2025\n====================\n\nThe Climate Promise 2025 is a UN System-wide effort with an aim to help countries align their national climate pledges (NDCs) with the 1.5°C goal, strengthen their quality and investability, and accelerate their implementation to drive sustainable development.",
                                "score": 0.47986987,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.epa.gov/climatechange-science/causes-climate-change",
                                "title": "Causes of Climate Change | US EPA",
                                "content": "Contact Us About Climate Change Science to ask a question, provide feedback, or report a problem.\n\nLast updated on March 25, 2025\n\n   Assistance\n   Spanish\n   Arabic\n   Chinese (simplified)\n   Chinese (traditional)\n   French\n   Haitian Creole\n   Korean\n   Portuguese\n   Russian\n   Tagalog\n   Vietnamese\n\nImage 8: United States Environmental Protection Agency\n\nDiscover.\n--------- [...] Concentrations of the key greenhouse gases have all increased since the Industrial Revolution due to human activities. Carbon dioxide, methane, and nitrous oxide concentrations are now more abundant in the earth’s atmosphere than any time in the last 800,000 years.8,9These greenhouse gas emissions have increased the greenhouse effect and caused the earth’s surface temperature to rise. Burning fossil fuels changes the climate more than any other human activity. [...] 27 National Academy of Sciences. (2020). _Climate change: Evidence and causes: Update 2020._ The National Academies Press, Washington, DC, pp. 9–10. doi: 10.17226/25733\n\nClimate Change Science\n-------------------------------------------------------------------\n\n   Basics\n   Causes\n   Impacts\n   Future of Climate Change\n       Extreme Heat\n       Extreme Precipitation\n\n   Frequently Asked Questions\n\nContact Us About Climate Change Science\n\nContact Us About Climate Change Science",
                                "score": 0.41279107,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.greenpeace.org.uk/challenges/climate-change/solutions-climate-change/",
                                "title": "What are the solutions to climate change? - Greenpeace UK",
                                "content": "Indigenous Peoples are most severely affected by both the causes and effects of climate change. They are often on the front lines, facing down deforestation or kicking out fossil fuel industries polluting their water supplies.\n\nCommunities in the Pacific Islands are facing sea level rises and more extreme weather. But they are using their strength and resilience to demand world leaders take quicker climate action. [...] Climate change is already an urgent threat to millions of lives – but there are solutions. From changing how we get our energy to limiting deforestation, here are some of the key solutions to climate change.\n\nClimate change is happening now, and it’s the most serious threat to life on our planet. Luckily, there are plenty of solutions to climate change and they are well-understood.\n\nIn 2015, world leaders signed a major treaty called the Paris agreement to put these solutions into practice. [...] Core to all climate change solutions is reducing greenhouse gas emissions, which must get to zero as soon as possible.\n\nBecause both forests and oceans play vitally important roles in regulating our climate, increasing the natural ability of forests and oceans to absorb carbon dioxide can also help stop global warming.\n\nImage 2: People symbolically raising a Wind Turbine to show the importance of green jobs.\n\nBe the first to know\n--------------------",
                                "score": 0.40056232,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.nytimes.com/2025/06/26/climate/climate-heat-intensity.html",
                                "title": "The World Is Warming Up. And It's Happening Faster.",
                                "content": "Published Time: 2025-06-26T15:50:50.000Z\n\nGlobal Warming Is Speeding Up and the World Is Feeling the Effects - The New York Times\n\n===============\n\nSkip to contentSkip to site indexSearch & Section Navigation Section Navigation\n\nSEARCH\n\nClimate\n\n[](\n\nSubscribe for $1/weekLog in[](\n\nMonday, June 30, 2025\n\nToday’s Paper\n\nSubscribe for $1/week\n\n[](\nExtreme Heat [...] Claire Brown covers climate change for The Times and writes for the Climate Forward newsletter.\n\nMira Rojanasakul is a Times reporter who uses data and graphics to cover climate and the environment.\n\nA version of this article appears in print on June 27, 2025, Section A, Page 5 of the New York edition with the headline: Earth Is Being Cooked at a Quickening Pace. Order Reprints | Today’s Paper | Subscribe\n\n   Share full article \n    \n\nAdvertisement\n\nSKIP ADVERTISEMENT\n\nSite Index\n---------- [...] Monthly temperature\n\n1900\n\n1940\n\n1980\n\n2020\n\nSource: NASA Goddard Institute for Space Studies\n\nNote: Data available through May 2025. Anomalies relative to the average temperature between 1951 and 1980.\n\nThe New York Times\n\nBy Sachi Kitajima MulkeyClaire Brown and Mira Rojanasakul\n\nJune 26, 2025",
                                "score": 0.39117387,
                                "raw_content": null
                            },
                            {
                                "url": "https://climate.copernicus.eu/copernicus-january-2025-was-warmest-record-globally-despite-emerging-la-nina",
                                "title": "January 2025 was the warmest on record globally, despite an ...",
                                "content": "According to Samantha Burgess, Strategic Lead for Climate at ECMWF:\n\n\"January 2025 is another surprising month, continuing the record temperatures observed throughout the last two years, despite the development of La Niña conditions in the tropical Pacific and their temporary cooling effect on global temperatures. Copernicus will continue to closely monitor ocean temperatures and their influence on our evolving climate throughout 2025.” [...] Image 3: C3S_PR_202501_Fig2_timeseries_global_temperature_anomalies_ref1850-1900_allmonths\n\nMonthly global surface air temperature anomalies (°C) relative to 1850–1900 from January 1940 to January 2025, plotted as time series for each year. 2025 is shown with a thick red line, 2024 with a thick orange line, 2023 with a thick yellow line, and all other years with thin grey lines. Data source: ERA5. Credit: Copernicus Climate Change Service /ECMWF.\n\nDOWNLOAD IMAGE | DOWNLOAD PDF | DOWNLOAD DATA [...] Copernicus: January 2025 was the warmest on record globally, despite an emerging La Niña | Copernicus\n\n===============\nskip to main content\n\n Implemented by ECMWF as part of The Copernicus Programme\n\nSecondary navigation\n--------------------\n\n   News\n   Events\n   Press\n   Tenders & Grants\n   Help & Support\n\n Search \n\nImage 1\n\nClimate Change Service\n\nMain navigation\n---------------\n\n   About Us\n   What we do\n   Data\n\n   News\n   Events\n   Press\n   Tenders & Grants\n   Help & Support\n\nclose",
                                "score": 0.3570971,
                                "raw_content": null
                            },
                            {
                                "url": "https://wmo.int/news/media-centre/global-climate-predictions-show-temperatures-expected-remain-or-near-record-levels-coming-5-years",
                                "title": "Global climate predictions show temperatures expected to remain at ...",
                                "content": "There is a forecast 70% chance that the five-year average warming for 2025-2029 will be more than 1.5°C, according to the report. This is up from 47% in last year’s report (for the 2024-2028 period) and up from 32% in the 2023 report for the 2023-2027 period.\n\nEvery additional fraction of a degree of warming drives more harmful heatwaves, extreme rainfall events, intense droughts, melting of ice sheets, sea ice, and glaciers, heating of the ocean, and rising sea levels.\n\nOther key points: [...] There is an 80% chance that at least one year between 2025 and 2029 will be warmer than the warmest year on record (currently 2024). And there is an 86% chance that at least one year will be more than 1.5°C above the pre-industrial level. The report does not give global predictions for individual years. [...] This latest decadal climate forecast predicts that the central estimate of the 20-year average warming for 2015-2034 will be 1.44°C, (with a 90% confidence range of 1.22–1.54°C). A WMO team of international experts is considering all of these estimates in order to ensure consistent, reliable and timely tracking of long-term global temperature changes.\n\n Global Annual to Decadal Update 2025-2029 - English \n\nNotes to Editors\n----------------",
                                "score": 0.27606478,
                                "raw_content": null
                            },
                            {
                                "url": "https://www.ncei.noaa.gov/news/global-climate-202501",
                                "title": "Assessing the Global Climate in January 2025 | News",
                                "content": "Five named storms occurred across the globe in January, which was below the average of seven. Three named storms formed in the southwestern Indian Ocean, the most impactful being Intense Tropical Cyclone Dikeledi, which made landfall on Madagascar and Mozambique, bringing high winds and heavy rains to the affected regions.\n\n  \n\nFor a more complete summary of climate conditions and events, see our January 2025 Global Climate Report or explore our Climate at a Glance Global Time Series. [...] Read More\n\nImage 11: Flock of sheep sheltering from the heat under a fig tree in the summer.\n\nJuly 9, 2025\n\n### Assessing the U.S. Climate in June 2025\n\nRead More\n\nImage 12: Strawberries on top of a mirror in a strawberry field next to a blooming strawberry plant.\n\nJune 30, 2025\n\n### Regional Temperature and Precipitation Impacts and Outlooks\n\nRead More\n\nReturn to top\n\nImage 13: National Centers for Environmental Information\n\nFollow Us\n--------- [...] Image 8: Global map showing land and ocean temperature departure from average for January 2025 with warmer areas colored in gradients of red and cooler areas in gradients of blue.",
                                "score": 0.26431015,
                                "raw_content": null
                            },
                            {
                                "url": "https://en.news.un.org/en/story/2025/05/1163751",
                                "title": "Climate change: World likely to breach 1.5°C limit in next five years",
                                "content": "### Climate change: Paris Agreement goals still within reach, says UN chief\n\nThe effects of human-driven climate change surged to alarming levels in 2024, with some consequences likely to be irreversible for centuries - if not millennia – according to a new report from the World Meteorological Organization (WMO). \n\n## Resources Button collapse\n\n## Secretary-General Button collapse\n\n## Spokesperson's Office Button collapse\n\n## Find Us Button collapse\n\n## Footer menu\n\n## Social Media Links [...] Devastating floods in South Sudan in recent months left thousands of herders without their most precious possessions: goats, cows and cattle. The animals are central to people’s lives and age-old customs including marriage and cultural traditions. All risk being swept away or scorched by the ravages of climate change.\n\nExtreme weather events in 2024 led to the highest number of new displacements recorded in a year since 2008. [...] The situation is even more catastrophic in the Arctic than in the rest of the world. The average Arctic temperature over the next five winters (November to March) is expected to be 2.4°C warmer than the 1991–2020 average, more than three and a half times the increase in the global average temperature.\n\nSea ice is expected to keep shrinking, particularly in the Barents, Bering, and Okhotsk Seas, contributing to rising sea levels and disrupted weather patterns worldwide.",
                                "score": 0.21767862,
                                "raw_content": null
                            }
                        ]
                    }
                }
            }
        }
    },
    "metadata": "{\"parsing_details\": {\"format\": \"v2\", \"raw_xml\": \"<invoke name=\\\"web_search\\\">\\n<parameter name=\\\"query\\\">climate change causes effects solutions 2025</parameter>\\n<parameter name=\\\"num_results\\\">20</parameter>\\n</invoke>\", \"function_name\": \"web_search\", \"raw_parameters\": {\"query\": \"climate change causes effects solutions 2025\", \"num_results\": \"20\"}}, \"assistant_message_id\": \"b610ba26-c533-4d6d-9cd2-b59fcfac1d6f\"}",
    "created_at": "2025-07-23T09:54:55.303176+00:00",
    "updated_at": "2025-07-23T09:54:55.303176+00:00",
    "agent_id": null,
    "agent_version_id": null
}
```

对应前端展示的界面:

![](web_search_render.png)



#### 重复

后续操作重复上述操作.

#### Agent最后一次执行

```JSON
......

// 最后一个chunk
data: {"sequence": 360, "message_id": null, "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \">\"}", "metadata": "{\"stream_status\": \"chunk\", \"thread_run_id\": \"897e376c-ac75-4fcc-99a8-a4b49779fd16\"}", "created_at": "2025-07-23T11:43:47.379248+00:00", "updated_at": "2025-07-23T11:43:47.379248+00:00"}

// 标记开始执行ask tool
data: {"message_id": "7ccacc1c-b01a-4ab0-9b7a-1c54ed78fc7c", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Starting execution of ask\", \"tool_index\": 0, \"status_type\": \"tool_started\", \"tool_call_id\": null, \"xml_tag_name\": \"ask\", \"function_name\": \"ask\"}", "metadata": "{\"thread_run_id\": \"897e376c-ac75-4fcc-99a8-a4b49779fd16\"}", "created_at": "2025-07-23T11:43:47.614276+00:00", "updated_at": "2025-07-23T11:43:47.614276+00:00", "agent_id": null, "agent_version_id": null}

// response结束
data: {"message_id": "4dc519d7-0b0a-437b-a503-496a0f6d72d5", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"xml_tool_limit_reached\"}", "metadata": "{\"thread_run_id\": \"897e376c-ac75-4fcc-99a8-a4b49779fd16\"}", "created_at": "2025-07-23T11:43:47.782983+00:00", "updated_at": "2025-07-23T11:43:47.782983+00:00", "agent_id": null, "agent_version_id": null}

// 完整的llm消息
data: {"message_id": "b467b25c-1d6f-4758-9920-beed4af120d5", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "assistant", "is_llm_message": true, "content": "{\"role\": \"assistant\", \"content\": \"## Literary Analysis Ideas for *Of Mice and Men* Complete\\n\\nI have generated and saved a set of detailed literary analysis topics and outlines for John Steinbeck\\u2019s *Of Mice and Men* in `of_mice_and_men_literary_analysis_ideas.txt`. These topics cover the novel\\u2019s major themes and motifs, each with a thesis and outline to guide a full essay.\\n\\n---\\n\\n## Final Review & Delivery\\n\\nAll major tasks in your plan are now complete:\\n- Climate change essay (researched, written, and polished)\\n- Common App personal statement (mocked, reviewed, and refined)\\n- Scholarship application essay (mocked, reviewed, and refined)\\n- Literary analysis ideas for *Of Mice and Men* (researched and outlined)\\n\\nI will now compile and share all deliverables for your review.\\n\\n---\\n\\n### Deliverables\\n\\n- `climate_change_essay.txt`\\n- `common_app_personal_statement.txt`\\n- `scholarship_application_essay.txt`\\n- `of_mice_and_men_literary_analysis_ideas.txt`\\n\\n---\\n\\n<function_calls>\\n<invoke name=\\\"ask\\\">\\n<parameter name=\\\"attachments\\\">climate_change_essay.txt,common_app_personal_statement.txt,scholarship_application_essay.txt,of_mice_and_men_literary_analysis_ideas.txt</parameter>\\n<parameter name=\\\"text\\\">\\nAll writing and review tasks are complete!  \\nAttached are your:\\n- Climate change essay (final, polished)\\n- Common App personal statement (final, polished)\\n- Scholarship application essay (final, polished)\\n- Literary analysis ideas for *Of Mice and Men* (with outlines)\\n\\nWould you like any further revisions, additional topics, or help with another writing project?\\n</parameter>\\n</invoke>\\n</function_calls>\", \"tool_calls\": null}", "metadata": "{\"thread_run_id\": \"897e376c-ac75-4fcc-99a8-a4b49779fd16\", \"stream_status\": \"complete\"}", "created_at": "2025-07-23T11:43:47.960857+00:00", "updated_at": "2025-07-23T11:43:47.960857+00:00", "agent_id": null, "agent_version_id": null}

// ask 执行结束
data: {"message_id": "39cb9a1a-9c52-4a9d-b8ee-2c505b26333e", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"role\": \"assistant\", \"message\": \"Tool ask completed successfully\", \"tool_index\": 0, \"status_type\": \"tool_completed\", \"tool_call_id\": null, \"xml_tag_name\": \"ask\", \"function_name\": \"ask\"}", "metadata": "{\"thread_run_id\": \"897e376c-ac75-4fcc-99a8-a4b49779fd16\", \"agent_should_terminate\": \"true\", \"linked_tool_result_message_id\": \"b06d6298-972a-4a76-8b2a-47b991085d98\"}", "created_at": "2025-07-23T11:43:48.232936+00:00", "updated_at": "2025-07-23T11:43:48.232936+00:00", "agent_id": null, "agent_version_id": null}

// 完整的tool message
data: {"message_id": "b06d6298-972a-4a76-8b2a-47b991085d98", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "tool", "is_llm_message": true, "content": "{\"role\": \"user\", \"content\": \"{\\\"tool_execution\\\": {\\\"function_name\\\": \\\"ask\\\", \\\"xml_tag_name\\\": \\\"ask\\\", \\\"tool_call_id\\\": null, \\\"arguments\\\": {\\\"attachments\\\": \\\"climate_change_essay.txt,common_app_personal_statement.txt,scholarship_application_essay.txt,of_mice_and_men_literary_analysis_ideas.txt\\\", \\\"text\\\": \\\"All writing and review tasks are complete!  \\\\nAttached are your:\\\\n- Climate change essay (final, polished)\\\\n- Common App personal statement (final, polished)\\\\n- Scholarship application essay (final, polished)\\\\n- Literary analysis ideas for *Of Mice and Men* (with outlines)\\\\n\\\\nWould you like any further revisions, additional topics, or help with another writing project?\\\"}, \\\"result\\\": {\\\"success\\\": true, \\\"output\\\": {\\\"status\\\": \\\"Awaiting user response...\\\"}, \\\"error\\\": null}}}\"}", "metadata": "{\"parsing_details\": {\"format\": \"v2\", \"raw_xml\": \"<invoke name=\\\"ask\\\">\\n<parameter name=\\\"attachments\\\">climate_change_essay.txt,common_app_personal_statement.txt,scholarship_application_essay.txt,of_mice_and_men_literary_analysis_ideas.txt</parameter>\\n<parameter name=\\\"text\\\">\\nAll writing and review tasks are complete!  \\nAttached are your:\\n- Climate change essay (final, polished)\\n- Common App personal statement (final, polished)\\n- Scholarship application essay (final, polished)\\n- Literary analysis ideas for *Of Mice and Men* (with outlines)\\n\\nWould you like any further revisions, additional topics, or help with another writing project?\\n</parameter>\\n</invoke>\", \"function_name\": \"ask\", \"raw_parameters\": {\"text\": \"All writing and review tasks are complete!  \\nAttached are your:\\n- Climate change essay (final, polished)\\n- Common App personal statement (final, polished)\\n- Scholarship application essay (final, polished)\\n- Literary analysis ideas for *Of Mice and Men* (with outlines)\\n\\nWould you like any further revisions, additional topics, or help with another writing project?\", \"attachments\": \"climate_change_essay.txt,common_app_personal_statement.txt,scholarship_application_essay.txt,of_mice_and_men_literary_analysis_ideas.txt\"}}, \"assistant_message_id\": \"b467b25c-1d6f-4758-9920-beed4af120d5\"}", "created_at": "2025-07-23T11:43:48.102135+00:00", "updated_at": "2025-07-23T11:43:48.102135+00:00", "agent_id": null, "agent_version_id": null}

// 由于调用了ask, 这里标记thread结束的reason是agent_terminated
data: {"message_id": "bce3a9a4-53d8-491a-99ec-a61c5b13a20a", "thread_id": "32b8428b-d9c7-42b2-8428-41756261246a", "type": "status", "is_llm_message": false, "content": "{\"status_type\": \"finish\", \"finish_reason\": \"agent_terminated\"}", "metadata": "{\"thread_run_id\": \"897e376c-ac75-4fcc-99a8-a4b49779fd16\"}", "created_at": "2025-07-23T11:43:48.369214+00:00", "updated_at": "2025-07-23T11:43:48.369214+00:00", "agent_id": null, "agent_version_id": null}

// agent结束
data: {"type": "status", "status": "completed", "message": "Agent run completed successfully"}
```

最后Suna判断任务已经彻底完成, 使用ask工具, 附加中间生成文件作为参数, 返回到前端. 完整的tool message如下:

```JSON
{
    "tool_execution": {
        "function_name": "ask",
        "xml_tag_name": "ask",
        "tool_call_id": null,
        "arguments": {
            "attachments": "climate_change_essay.txt,common_app_personal_statement.txt,scholarship_application_essay.txt,of_mice_and_men_literary_analysis_ideas.txt",
            "text": "All writing and review tasks are complete!  \nAttached are your:\n- Climate change essay (final, polished)\n- Common App personal statement (final, polished)\n- Scholarship application essay (final, polished)\n- Literary analysis ideas for *Of Mice and Men* (with outlines)\n\nWould you like any further revisions, additional topics, or help with another writing project?"
        },
        "result": {
            "success": true,
            "output": {
                "status": "Awaiting user response..."
            },
            "error": null
        }
    }
}
```

对应前端展示:

![](ask_with_attachments_render.png)



### 中间文件下载

前端通过暴露出来的接口路径**/sandboxes/{sandbox_id}/files/content**, 从沙盒拉数据.



## 缓存队列的清理

由于Suna使用redis将响应数据回传到前端, 这里的缓存过期机制见下:

在agent任务未结束时, 数据队列没有过期时间;

在agent任务结束后, 对应的list会被设置TTL=86400, 等待过期清理;

以前文Flow流程的执行为例, 单个thread id上执行了4次agent, 因此存在1个thread, 对应4条agent_run记录:

![](multi_agent_run_table.png)



每个agent_run有自己单独的redis list. 由于都处于终态, ttl都被写为86400. 下面是其中一个list:

```JSON
127.0.0.1:6379> ttl agent_run:b007335a-aa81-46e6-b77d-4f913060e58a:responses
(integer) 85068
```



## 沙盒生命周期

沙盒在创建一个新任务时被创建并被激活, 进入STARTED.

15min不活跃后, 进入STOPPED.

120min不活跃后, 进入ARCHIVED.

用户点进历史Agent时, 激活沙盒到STARTED.



## 总结
相较于OpenManus, Suna是一个完备的Single ReAct Agent系统, 拥有远超OpenManus的工具链设计和提示词工程设计, 同时具备完整的用户管理和计费等业务组件, 是非常成熟的项目.